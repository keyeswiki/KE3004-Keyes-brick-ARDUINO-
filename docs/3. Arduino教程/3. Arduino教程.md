# Arduino教程

## 开发环境配置

### 第一小节 在Windows系统电脑详细使用方法

![](media/6cf6312dc7c7db27794b54d58a8bf80c.png)

（1）安装Arduino IDE

你可以进入以下网址下载Arduino IDE：<https://www.arduino.cc/>，点击![](media/6e0a6f98ef8676a190750e098ff76bc2.png)后，显示如下图。

![](media/029dbd0414641c01ef3e3aba94609358.png)

点击下图，

![](media/6b838391b7b8c418fbc8426ff0272f96.png)

就可以下载最新的1.8.13版本IDE，同时我们可以点击下图，选择你需要的版本IDE。

![](media/5c3d01abae581ed8e03adb81eb9282f0.png)

我们选择安装1.8.13版本Arduino IDE，当我们点击![](media/03e5562de7a3b2ec4f1f6dc873e2d600.png)，代表下载安装文件(.exe)
，需要手动安装。当我们点击![](media/09b91b3ac2cfec8d93863073fbe0a7c0.png)，代表直接下载1.8.12版本Arduino IDE，是一个压缩文件，解压就可以使用，无需安装。

![](media/502b69de2bc753e0d1096af1068a0e53.png)

（2）安装驱动文件

软件下载完毕，我们开始为Uno Plus 开发板安装驱动。Uno Plus
开发板的USB转串口芯片用的是著名的CP2102 芯片，在ARDUINO
开发软件1.8以上的版本里就已经包含了这个芯片的驱动程序，这样我们使用起来会非常方便。一般插上USB，电脑就会识别到硬件，WINDOWS就会自动安装CP2102的驱动。![](media/fe2c97ce022a5a071b2530328df74008.png)

如果驱动安装不成功，或者你想手动安装驱动，请打开电脑的设备管理器![](media/5d3921d98a5be791b0b5166164b389e7.png)

显示CP2102的驱动没有安装成功，有一个黄色的感叹号。我们双击硬件更新驱动

![](media/0946d3e3d322e66303a5e3fec0bb53c0.png)

浏览计算机查找驱动程序，先找到我们安装或者下载的ARDUINO开发软件

![](media/abff63e491413339a985a0a03df21106.png)

里面有个dirvers文件夹，打开文件夹就能看到CP210X系列芯片的驱动，

![](media/df4f1023d547347f2aa3a44f09b84efe.png)

我们选择这个文件夹，然后点击确定，驱动安装成功。

![](media/1e888fdeb85783a123b6948dffa44a97.png)

这个时候再打开设备管理器，我就可以看到CP2102的驱动程序已经安装成功了，刚刚的那个黄色的感叹号不见了。

![](media/6ec68bee80c913c6ad392c6e7898ed36.png)

（3）Arduino IDE设置和工具栏介绍

首先我们点击文档中的![](media/449389031648dfc4a5b2bd39132fae99.png)图标，打开Arduino IDE。

![](media/e9a2d59afcff8121d18d8767326baa42.png)

为了避免在将程序上载到板上时出现任何错误，必须选择正确的Arduino板名称，该名称与连接到计算机的电路板相匹配。转到Tools→Board，然后选择你的板。

![](media/84317a7babddff172520b99756dc1f85.png)

然后再选择正确的COM口（安装驱动成功后可看到对应COM口）。

![](media/6ec68bee80c913c6ad392c6e7898ed36.png)

![](media/bcd36a3d3e1209c16866e554089832d5.png)

我们的程序上传到板之前，我们必须演示Arduino IDE工具栏中出现的每个符号的功能。

![](media/2598b31529ac4bff88630522b97b6c41.png)

A - 用于检查是否存在任何编译错误。

B - 用于将程序上传到Arduino板。

C - 用于创建新草图的快捷方式。

D - 用于直接打开示例草图之一。

E - 用于保存草图。

F - 用于从板接收串行数据并将串行数据发送到板的串行监视器。

（4）启动你的第一个程序

打开文件选择例子，选择第一个文件BASIC里面的BLINK程序

![](media/2a6a0b8b8e2585776e01873caf10a1b0.png)

![](media/6030cde1341c3432f0f4b1fb6c92e49e.png)

按照前面方法设置板和COM口，IDE右下角显示对应板和COM口。

![](media/5c4521f3fa5c4f4c0a5c9d1581ab1580.png)

点击![](media/ddd21c81338ae1f6b7f84de2a3caecf0.png)图标开始编译程序，检查错误，检查无误。

![](media/9948cd36a3b39cb57fd2bea79540c4b7.png)

点击点击![](media/9c9158a5d49baa740ea2f0048f655017.png)图标开始上传程序，上传成功。

![](media/60e002aacf662c1ecf88ad3ecd85e6ca.png)

程序上传成功，板载的LED灯亮一秒钟，灭一秒钟，恭喜你的第一个程序完成了！

![](media/19c8dfd92586ad19678edb962b8f8be7.png)

### 第二小节 在MAC系统电脑详细使用方法

![](media/a6fc83596009c574d8e29ef383748549.png)

（1）下载安装Arduino IDE 

不同的系统，需要下载不同的Arduino IDE，下载方式和第二小节类似。选择如下图。

![](media/93fb6f19be3ac6e5fd992aab76c5bb60.png)

（2）驱动安装方法

打开目录下的mac驱动文件夹，双击SiLabsUSBDriverDisk.dmg文件

![](media/085063de72596eed265264de6570a228.jpg)

可以看到以下文件

![](media/3f1afe9499f6d852492cfb9d6b11e9ab.jpg)

双击 Install CP210x VCP Driver ，接着勾上Don’t warn me ，点击Open

![](media/8d7fedad226b17b2444d6ad1c7925577.jpg)

点击Continue

![](media/b1cb125dccf6470ebe255f8f65b902eb.jpg)

继续点击Continue ，然后点击Agree

![](media/865dcc76cb7f58854b56f1020233f05e.jpg)

点击Continue ，然后输入你的用户密码

![](media/1ef6d65b61ad7c6e0a3989ba59de74d5.jpg)

![](media/b4e122b521d3e9301d2b70e00ed504be.jpg)

系统安全问题，需要允许安装，点击 Open Security Preferences

![](media/f97f0c1a960ddda5c2a98f52386f0462.png)

点击安全锁 ，输入你的用户密码来授权

![](media/cb6be428257143635fc4f729487549c5.jpg)

![](media/e8f637a3a9510aa8f90c65820d4d1cd8.jpg)

看到锁被打开了，点击Allow

![](media/250a1cbb7f93fc2a572944bea9fe5494.jpg)

回到安装界面，根据提示等待安装

![](media/62303433d3c44819f9c6d58e6de1f0d3.jpg)

安装成功

![](media/d33ca66538f709ad96ee49a9b585ac7f.jpg)

（3）Arduino IDE设置

在 Arduino IDE设置时，方法和5.3章节类似，只是设置COM口时不同，如下图。

![](media/b55157aad3daf7554d699f1bb14145e7.jpg)

### 第三小节 库文件的添加

库文件。

(1)什么是库文件?

库是一组代码，可以方便地连接到传感器、显示器、模块等。例如，内置的LiquidCrystal库可以帮助与LCD显示器对话。Internet上还有数百个额外的库可供下载。参考资料(https://www.arduino.cc/en/Reference)中列出了内置库和其中一些附加库。

(2)如何安装库 ?

这里我们将介绍一种最简单的添加库的方法 .

第一步：打开文件的安装目录，如下所示：

![](media/64cbf979631b3484697c7548e8fb86ee.png)

第二步：
单击打开安装目录下的libraries文件夹，你可以看到library这个文件夹里面含有一些Arduino的库文件。

![](media/659a676ccb7307a1d30e65447ef2f43f.png)

![](media/effd547a0ca8d5a44799d3c0949a7776.png)

第三步：打开我们提供资料里面的**库文件夹**，将文件夹中的库文件都复制粘贴到第二步我们打开的libraries文件夹内。

![](media/a1e7639af43de9864d45e49ad60e6c38.png)

复制好了之后我们的库文件就添加成功了。

![](media/6a4ea1fc0b859861e3429b554728307e.png)

这样，库文件就手动添加完成了。






## 安装步骤

安装1

安装所需零件

![](media/d4903855e20d5a6f982f9ac90a4f81fb.png)

安装

![](media/4fdb61d276182932caedfa62f7ebd575.png)

完成

![](media/fd4bc3e791ab2f4971a38d31e0beb4f5.png)

安装2

安装所需零件

![](media/8761a0a5a90cfb9c073abf84e30bd165.png)

安装

![](media/0fccabbb750d3fe36f7ef7bfc1837c94.png)

完成

![](media/559672aacd3bc96f6a8e6caaaeac24c3.png)

安装3

安装所需零件

![](media/c31b2d3867c25b77bb8bcd2e306fc8a9.png)

安装

![](media/9ba56371f1d88e666d92c77060299a7b.png)

完成

![](media/4dbb95603f23e0639074fccadf403114.png)

安装4

安装所需零件

![](media/89_1.png)

安装

![89_2](media/89_2-17472774036661.png)

若使用为M1.4*6MM自攻螺丝时，如下图

![](media/100.png)

完成

![](media/89_3.png)

安装5

安装所需零件

![](media/58428c9d987974edfaaab39a8b18ea84.png)

安 装

![](media/89_4.png)

完成

![](media/89_5.png)

将舵机角度调到0度

![](media/7860a7fb2fe9685ead6de6578232d883.png)

如图接好线上传目录下程序

![](media/72574afcf9dd2d23d769847d994f99be.png)

到开发板，舵机自动转动到0度，再进行安装（注意：这一步很重要）

安装6

安装所需零件

![](media/3f3830f8f82796243dc149c27c9fb1ba.png)

安 装（安装自锁螺母时不可拧紧，安装时窗户为闭合状态如下图所示）

![](media/bb0993d5c2eee787673c9986fcebbcfa.png)

完成

![](media/92f9f949c080cc89f298781be7532e05.jpg)

安装7

安装所需零件

![](media/fd29cb2e81308f691a0579d3c5c7c68f.png)

安装

![](media/40c4fbe0acdfb1ec5e9e32a6a915ce75.png)

完成

![](media/b31168fdd6794e81ca5707ad9cdf7d9e.png)

安装8

安装所需零件

![](media/0b15cc2a0d9f0f13936c2a97e9af18ad.png)

安装

![](media/7f0fa4f189df4857747319585eb94389.png)

完成

![](media/9204f16f9cc903550123e851d1cbd5aa.png)

安装9

安装所需零件

![](media/04ec55e45b6dc6f5140de45e25eb5bc4.png)

安装

![](media/35d3d73f1b6a6c01365fc57f8a3f5b6e.png)

完成

![](media/c61120c702cbf945548572864667258d.png)

安装10

安装所需零件

![](media/5300b5477ec7b8a55263b48a62967c2b.png)

安装

![](media/783b8dbbdc290f151abd72994eba60e6.png)

完成

![](media/ecf4b3efdabfe913bb55e81d045f092b.jpg)

安装11

安装所需零件

![](media/95335e9584578961f0111daf988bf9de.png)

安装

![](media/e82aee91145ff72453bb46538b4dab9b.png)

完成

![](media/862b720f36f280d09311b3ae5c32cdd6.png)

安装12

安装所需零件

![](media/aec4d11fefcc0bd0b012da75cc0ec337.png)

安装

![](media/726c4b7d1c495acbf4358ebbdadf9b9e.png)

完成

![](media/b79cc90719d64a8ba36cc28959f955c7.png)

安装13

安装所需零件

![](media/8e2d77f1b450f9d3ed146515dea1919c.png)

安装

![](media/9e48e6ff9f03d5d38c9960b4867801e8.png)

完成

![](media/2ce0324018b180f626fb1651ddf0c86d.png)

安装14

安装所需零件

![](media/1f00c50cd5f91bcca562de30a821f2f7.png)

安装

![](media/7d6a0b2055d1b25c6a54f4e9cbe26950.png)

完成

![](media/90eb8b2ac6f0e5d793afd66d2cb67e09.png)

安装15

安装所需零件

![](media/d0a025c6406bfc84d9a4952a3d61c375.png)

安装

![](media/4bec70766733615f90691e41f9fe5ac5.png)

完成

![](media/d1f07d7c44e1362f7efac79f19501400.png)

安装16

安装所需零件

![](media/8c3ad995c343b5345672ceb529ab834b.png)

安装

![](media/1bfb09f5423df7e0d251847b355472f0.png)

完成

![](media/53d9cacb8faf8dff2ed9d7680c98edf2.png)

安装17

安装所需零件

![](media/a31df64dec197768a475d465141e9202.png)

安装

![](media/0d5dcf52a2fbbdea1eb12f05c5a0e848.png)

完成

![](media/419e9c258cf9cb09ad2dded744bdf3df.png)

安装18

安装所需零件

![](media/5ddcd1bcdf563792f6f2ebd45395785e.png)

安装

![](media/49a4efde2ec7925161b89feca0953b4e.png)

完成

![](media/281a7427db03c4ccc23e394a378f75a8.png)

安装到此即可开始接线

人体红外传感器接线

![](media/60bdd38aecfcdec619c1b4a0a67b1ec9.png)![](media/5fc90f59511d1cbcf3d64c204b1379e7.png)

人体红外释热传感器




按键模块1接线


![](media/daba34016e16242d627132dc2bb1159e.png)![](media/f993f2ef1730b12956f9740a574731c5.png)




按键模块2接线


![](media/9a337dd5a9e23cf1d4779b3b6115d9fb.png)![](media/23b15cd1418ee9954ab17722ec50cd2d.png)




黄色LED模块接线


![](media/e7c5d76594146e2f81b21088ce0b62b1.png)![](media/f7ef18ef64e086b18acc9c7a638c92dc.png)



黄色LED模块


LCD1602显示屏模块


![](media/1e47d997a3c4d28cbfe66e6f8e1bbd1b.png)![](media/39f6de0d37027f94d008b1653dd3cbe6.png)



LCD1602显示屏模块


水滴传感器接线


![](media/0b6d7a165cdcaaa748bba28a5b171b96.png)![](media/35e64a51b865b10718e24b05436cefc0.png)



水滴传感器


温湿度传感器接线


![](media/d0c97a12ecc26f514d01eed0c210d64c.png)![](media/7f45c9a1bce12ba0c8f09492b0a22795.png)



温湿度传感器


光敏传感器接线


![](media/32ce4b51cdb78c27a407f83a8924c20d.png)![](media/3294f50ba63e3cea8c48f07d34021b19.png)



光敏传感器


风扇模块接线


![](media/564ba0b0164ef71bde4981fe72849197.png)![](media/f825eed355494dac90ff9d3d5f0a3a88.png)



风扇模块


RGB灯模块接线


![](media/70b3a219ae917623e6e2684332d36bf0.png)![](media/5c334e9a50a0a46f090e28bbaf465578.png)



RGB灯模块


无源蜂鸣器模块接线


![](media/211884fa35ac9f6e9d3b942c5ef1bb24.png)![](media/92fd3441aa9d9a9c2cb7215907d4547a.png)



无源蜂鸣器模块


电池盒接线

![](media/7838738fe32f451c7c83fd0c1d26ec5c.jpg)![](media/c578509f8562292a7a9c373597abefd4.jpg)![](media/6dcedb4669bb96a93b385c4d68d57878.png)

模拟气体传感器接线


![](media/35bff37e18054d880be500a9b192056e.png)![](media/912a6f43ef41bcab06261a302772f488.png)



模拟气体传感器


控制门的舵机接线


![](media/75a4621ac71645f54e41000312e7b069.png)



控制门舵机


控制窗户舵机接线


![](media/62cd2703550678df34ef73f02d4635f1.png)



控制窗户舵机


电源接线

![](media/b94e60e297092a199c0c36af26b50b62.png)

太阳能板接线

![](media/708983877e2b213c72023071500c2e5e.png)

接完线后即可安装最后一步

安装所需零件

![](media/b37ac9fa799439697cb1c988b8b1dc22.png)

安装

![](media/82dcbcf5dbda2d78e2ae7f8a24d3a2fa.png)

完成

![](media/cf307e319a130ff616a53d9f29b100e6.png)


### 舵机复位程序

#### 接线

把两个舵机接到扩展板的9号和10号引脚后叠加到PULS控制板上如下图

![](media/7860a7fb2fe9685ead6de6578232d883.png)

#### 上传程序

(1)复制下面的程序或者打开资料下的**舵机复位程序**

```C
/*
  Keyes Arduino 智能家居套装
  舵机复位程序
  http://www.keyes-robot.com
*/
int servo1Pin = 9;//舵机1的PIN
int servo2Pin = 10;//舵机2的PIN

void setup() {
  pinMode(servo1Pin, OUTPUT);//舵机1引脚设置为输出
  pinMode(servo2Pin, OUTPUT);//舵机2引脚设置为输出
}
void loop() {
  servopulse(servo1Pin, 0);//舵机1转动到0度
  delay(1000);//延时1秒
  servopulse(servo2Pin, 0);//舵机2转动到0度
  delay(1000);
}

void servopulse(int pin, int myangle) { //脉冲函数
  int pulsewidth = map(myangle, 0, 180, 500, 2500); //将角度映射到脉宽
  for (int i = 0; i < 5; i++) { //多输出几次脉冲
    digitalWrite(pin, HIGH);//将舵机接口电平至高
    delayMicroseconds(pulsewidth);//延时脉宽值的微秒数
    digitalWrite(pin, LOW);//将舵机接口电平至低
    delay(20 - pulsewidth / 1000);
```


(2)开发板连接好电脑，选择好开发板和串口，点击上传程序，程序上传成功后舵机自动转到0度的位置

![](media/f868f3a5aca7b137b0abeb530fba65ff.png)




## 项目课程

### 第1课LED闪烁

1.1 项目介绍：

前面我们已经组装好了智能家居。接下来的项目我们就要由简单到复杂，一步一步探索Arduino的世界了。首先我们要来完成经典的“Arduino点亮LED”，也就是Blink项目。Blink对于学习Arduino的爱好者而言，是最基础的项目，也是新手必须经历的一个练习。

LED，即发光二极管的简称。由含镓（Ga）、砷（As）、磷（P）、氮（N）等的[化合物](https://baike.baidu.com/item/%E5%8C%96%E5%90%88%E7%89%A9/1142931)制成。当电子与[空穴](https://baike.baidu.com/item/%E7%A9%BA%E7%A9%B4/3517781)复合时能辐射出可见光，因而可以用来制成发光二极管。在电路及仪器中作为指示灯，或者组成文字或数字显示。砷化镓二极管发红光，磷化镓二极管发绿光，碳化硅二极管发黄光，氮化镓二极管发蓝光。因化学性质又分有机发光二极管OLED和无机发光二极管LED。

为了实验的方便，我们将LED发光二极管做成了一个LED模块，在这个项目中，我们用一个最基本的测试代码来控制LED，亮一秒钟，灭一秒钟，来实现闪烁的效果。你可以改变代码中LED灯亮灭的时间，实现不同的闪烁效果。LED模块信号端S为高电平时LED亮起，S为低电平时LED熄灭。

1.2 模块相关资料：

 工作电压: DC 3.3-5V ![](media/98a79cea0b6dae9d2b47785668ed2f9b.png)

 工作电流： &lt; 20mA

 最大功率： 0.1W

 控制接口: 数字口（数字输入）

 工作温度： -10°C ~ +50°C

 LED显示颜色： 黄色

1.3 实验组件：

 ![](media/11f300186a5fe1563643d26a52e29cee.png) 

![](media/9a5323418acdfc5911e04dd4ddcd0b1b.jpg) ![](media/5ff79cbf407333d10c51ddeb32401630.png) 

![](media/1b75ff37c28a8008ad7c2dbe3408a9df.png) ![](media/45853454e3bc5dd2d4610be37fbbca29.png)

 控制板 * 1 扩展板 * 1 USB线*1 LED模块 3P 转杜邦线母*1

1.4模块接线图：

![](media/1a88b1b5b2f228d4d31484c0c89b5b03.png)

注意：这里体现的是实验使用到的模块接线图，若前面已经组装好智能家居并不用拆掉怎么上传程序？

打开目录下我们提供的示例程序，选择开发板和串口，点击编译没错再上传，上传成功会在软件的左下角有提示

![](media/94af7bad31f1cd8838d37985f21ca20b.png)

1.5测试代码：

```
/*
  Keyes
  Blink
  www.keyes-robot.com
*/
int LED = 5;  //定义LED引脚
void setup() {
  pinMode(LED, OUTPUT);//设置引脚为输出
}

void loop() {
  digitalWrite(LED, HIGH);   // 点亮LED灯
  delay(1000);               // 延时1s
  digitalWrite(LED, LOW);    // 熄灭LED灯
  delay(1000);               // 延时1S
}

```

1.6实验结果：

将再将船型开关上的“1”端按下，同时黄色LED亮1000毫秒，灭1000毫秒，循环交替。

1.7 代码说明:

 pinMode(LED, OUTPUT); 设置引脚为输出模式

 digitalWrite(LED, HIGH); 设置引脚输出高电平

 delay(1000); 延时1000毫秒

 digitalWrite(LED, LOW); 设置引脚输出低电平

### 第2课 呼吸灯

1.1 项目介绍：

![](media/bbcfcb9ae56abb7e80ee587246fc4be9.gif)前面课程中，我们详细的介绍了通过测试代码控制LED亮灭，实现闪烁的效果。这节课我们使用PWM来控制LED亮度不断地变化，模拟我们呼吸的效果。

PWM是使用数字手段来控制模拟输出的一种手段。使用数字控制产生占空比不同的方波（一个不停在高电平与低电平之间切换的信号)来控制模拟输出。一般来说端口的输出电压只有两个0V与5V。如果想要改变灯的亮度怎么办呢个？有同学说串联电阻，对，这个方法是正确的。但是，如果想要得到不同的亮度，且在不同亮度之间来回变动怎么办呢？不可能不停地切换电阻吧。这种情况下就需要使用PWM了，那它是怎么控制的呢？

对于keyes UNO PLUS开发板的数字端口电压输出只有LOW与HIGH两个，对应的就是0V与5V的电压输出，可以把LOW定义为0，HIGH定义为1，1秒内让keyes UNO PLUS开发板输出500个0或者1的信号。如果这500个全部为1，那就是完整的5V，如果全部为0，那就是0V。如果010101010101这样输出，刚好一半，端口输出的平均电压就为2.5V了。这个和放映电影是一个道理，咱们所看的电影并不是完全连续的，它其实是每秒输出25张图片。在这种情况下，人的肉眼是分辨不出来的，看上去就是连续的了。PWM也是同样的道理，如果想要不同的电压，就控制0与1的输出比例控制就可以了。当然这和真实的连续输出还是有差别的，单位时间内输出的0,1信号越多，控制的就越精确。（输出电压=（开启时间/脉冲时间）\*最大电压值）

在下图中，绿线之间代表一个周期，其值也是PWM频率的倒数。换句话说，如果keyes UNO PLUS开发板的PWM频率是500Hz，那么两绿线之间的周期就是2毫秒。
analogWrite()命令中可以操控的范围为0-255，analogWrite(255)表示100%占空比（常开），analogWrite(127)占空比大约为50%（一半的时间）。

![](media/553f3d1b6ca04e1aa0479841dd075fa2.png)![](media/25b9663b129fdaa23e1e6ec0a4bd9df0.jpg)

脉冲宽度调制（PWM）有多种应用：灯亮度调节、电机调速、发声等。
以下是PMW的四个基本参数：

![](media/b14db369936f55eef1dd18b050682a10.png)

（1）脉冲宽度的振幅（最小/最大）

（2）脉冲周期（1秒内脉冲频率的倒数）

（3）电压水平（如：0V-5V）

（4）keyes UNO PLUS开发板的PMW接口：D3 D5 D6 D9 D10 D11

1.2 模块相关资料：

 工作电压: DC 3.3-5V ![](media/98a79cea0b6dae9d2b47785668ed2f9b.png)

 工作电流： &lt; 20mA

 最大功率： 0.1W

 控制接口: 数字口（数字输入）

 工作温度： -10°C ~ +50°C

 LED显示颜色： 黄色

1.3 实验组件：

 ![](media/11f300186a5fe1563643d26a52e29cee.png) ![](media/c229c49ec658d5e5d4f52d629d74a47f.jpg) ![](media/5ff79cbf407333d10c51ddeb32401630.png) ![](media/205a514d50f8234d4743f86346a2de64.png) ![](media/45853454e3bc5dd2d4610be37fbbca29.png)

 控制板 * 1 扩展板 * 1 USB线*1 6812模块 3P 转杜邦线母*1

1.4模块接线图：

![](media/1a88b1b5b2f228d4d31484c0c89b5b03.png)



注意：这里体现的是实验使用到的模块接线图，若前面已经组装好智能家居并不用拆掉

1.5测试代码：

```
/*
  Keyes Arduino智能家居套装
  第二课 呼吸灯
  www.keyes-robot.com
*/
int ledPin = 5; //定义LED引脚
void setup () 
{
      pinMode (ledPin, OUTPUT); // 设置引脚为输出模式
}
void loop () 
{
    for (int value = 0; value<255; value = value + 1) 
    {  //从0到255，每次加1
         analogWrite (ledPin, value); 
         delay (5); // 延时 5MS
     }
     for (int value = 255; value>0; value = value-1) 
     { //从0到255，每次减1
         analogWrite (ledPin, value); 
         delay (5); // 延时 5MS
     }
}
```

1.6实验结果：

将再将船型开关上的“1”端按下，黄色LED灯逐渐变暗。然后又逐渐变亮，循环交替，如人体呼吸一样。

1.7 代码说明:

 pinMode(LED, OUTPUT); 设置引脚为输出模式

 int value = 0; value&lt;255; value = value +1 value从0到255，每次加1

 analogWrite (ledPin, value); ledPin为PWM口，value是要输出的PWM值（0~255）

### 第3课 6812RGB彩灯

1.1 项目介绍：

我们这个套价中，还有一个Keyes DIY电子积木 6812 RGB模块，这个SK6812 RGB模块只需要一个引脚就能控制，这是一个集控制电路与电路于一体的智能外控LED光源。每个LED原件其外型与一个5050LED灯珠相同，每个元件即为一个像点，我们这个模块上有四个灯珠即四个像素，实验中，我们分别使不同的灯亮出不同的颜色。

1.2 模块相关资料：

从原理图中我们可以看出，这四个像素点灯珠都是串联起来的，其实不论多少个，我们都可以用一个引脚控制任一一个灯，并且让它显示任一种颜色。像素点内部包含了智能数字接口数据锁存信号整形放大驱动电路，还包含有高精度的内部振荡器和12V高压可编程定电流控制部分，有效保证了像素点光的颜色高度一致。

数据协议采用单线归零码的通讯方式，像素点在上电复位以后，S端接受从控制器传输过来的数据，首先送过来的24bit数据被第一个像素点提取后，送到像素点内部的数据锁存器。这个6812RGB通讯协议与驱动已经在底层封装好了，我们直接调用函数的接口就可以使用，简单方便，LED具有低电压驱动，环保节能，亮度高，散射角度大，一致性好，超低功率，超长寿命等优点。

![](media/f0d824a10a88aa0fbabfb685634672fc.png)

1.3 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/6c14334b97f965614e1d2130b699d649.png) ![](media/a0a4440f98f604fe19573abb5ad735cf.png) ![](media/0b475062a35179a5895b47951b109e90.png)

 控制板 * 1 扩展板 * 1 USB线*1 LED模块 3P 转杜邦线母*1

1.4模块接线图：

![](media/bc1dac43f55da545bdaf7e4feba6ef4c.png)

这里使用到两个库函数![](media/720e7b592e2c4c7655e307b99ceb0c02.png)，前面若没有添加库函数的，需要添加，否则编译不过，添加方法请查看”开发环境配置”。

1.5测试代码：

```
/*
  Keyes Arduino智能家居套装
  第三课 6812RGB
  http://www.keyes-robot.com
*/
//添加RGB6812库文件
#include <Wire.h>
#include <Adafruit_NeoPixel.h>

Adafruit_NeoPixel  rgb_display(4);  //定义一个像素的类

void setup() {
  rgb_display.begin();  //启动6812RGB
  rgb_display.setPin(13);  //设置6812管脚接数字口13
  rgb_display.setBrightness(80); //设置亮度为100，范围为0~255
}

void loop() {
  rgb_display.setPixelColor(0, 255, 0, 0); //第一颗灯珠亮红色
  rgb_display.setPixelColor(1, 0, 255, 0); //第二颗灯珠亮绿色
  rgb_display.setPixelColor(2, 0, 0, 255); //第三颗灯珠亮蓝色
  rgb_display.setPixelColor(3, 255, 255, 255); //第四颗灯珠亮白色
  rgb_display.show(); //显示灯珠颜色

}
```

1.6实验结果：

将再将船型开关上的“1”端按下,按照接线图连接好线，上电后，我们可以看到模块上的四个灯珠分别亮红绿蓝白色；

1.7 代码说明:

我们介绍下主要的几个函数接口及功能：

rgb_display.begin();这个函数用来初始化6812RGB，这是必要的

rgb_display.setPin(13);这个函数用来设置6812RGB所连接的引脚，是必要的

rgb_display.setBrightness(80);这个函数用来设置6812RGB显示的亮度，范围是（0~255），值越大，灯珠越亮，如果我们没有设置亮度，那么默认255，也就是最亮。

rgb_display.setPixelColor(uint16_t n, uint8_t r, uint8_t g, uint8_t b);这个函数用来设置6812RGB的灯珠号也就是位置，及每颗灯珠的颜色。

rgb_display.show();这个函数用来设置显示6812RGB，是必要的，如果没有这条语句，灯珠将不刷新显示

### 第4课 无源蜂鸣器播放音乐

1.1 项目介绍：

本实验用无源蜂鸣器播放音乐，无源蜂鸣器是通过PWM脉冲宽度调制脉冲进而调节音调，

PWM比较多用于调节LED灯的亮度或者调节无源蜂鸣器的频率，或者是电机的转动速度，电机带动的车轮速度也就能很容易控制了，在玩一些Arduino机器人时，更能体现PWM的好处。

音乐除了要“唱的准”，还要“节奏对”，每一个音符的持续时间，就是节拍啦。我们可以用延时多少来设置节拍的，例如：1拍，1秒即1000毫秒；1/2拍，0.5秒即500毫秒；1/4拍，0.25秒即250毫秒；1/8拍，0.125秒即125毫秒….，我们可以试一试组合不同的音调和节拍，看看会有什么不同的效果。

1.2 模块相关资料：

![](media/1f32014579a6eabb51d23d8ea7cc2812.png)

工作电压：3.3-5V（DC）

电流：50MA

工作温度：-10摄氏度 到 +50摄氏度

尺寸：31.6mmx23.7mm

接口：3PIN接口

输入信号：数字信号（方波）

1.3 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/6c14334b97f965614e1d2130b699d649.png) ![](media/3e05cae18da9549123032b0bd479d866.png) ![](media/0b475062a35179a5895b47951b109e90.png)

 控制板 * 1 扩展板 * 1 USB线*1 无源蜂鸣器模块 3P 转杜邦线母*1

1.4模块接线图：

![](media/61587b0a02eed79dc3c2bf15b5a3df63.png)

1.5测试代码：

```

1/*
  Keyes Arduino智能家居套装
  第4课 无源蜂鸣器
  http://www.keyes-robot.com
*/
void setup(){
  pinMode(3, OUTPUT);        //设置3为输出
}
void loop(){
  tone(3,392);          //控制引脚3输出模拟值为262的脉冲
  delay(125);         //延迟125毫秒   
  tone(3,392);
  delay(125);
  tone(3,440);
  delay(250);
  tone(3,392);
  delay(250);
  tone(3,532);
  delay(250);
  tone(3,494);
  delay(500);
  tone(3,392);
  delay(125);
  tone(3,392);
  delay(125);
  tone(3,440);
  delay(250);
  tone(3,392);
  delay(250);
  tone(3,587);
  delay(250);
  tone(3,532);
  delay(500);
  tone(3,392);
  delay(125);
  tone(3,392);
  delay(125);
  tone(3,784);
  delay(250);
  tone(3,659);
  delay(250);
  tone(3,532);
  delay(250);
  tone(3,494);
  delay(250);
  tone(3,440);
  delay(250);
  tone(3,392);
  delay(125);
  tone(3,392);
  delay(125);
  tone(3,330);
  delay(250);
  tone(3,262);
  delay(250);
  tone(3,587);
  delay(250);
  tone(3,532);
  delay(500);
}
```

1.6实验结果：

上传代码到开发板，就会听到无源蜂鸣器播放这首“生日快乐歌”了

1.7 代码说明:

在音乐中有两个重要的因素：音调和节拍

在音乐课上，老师教过我们唱“1（Do）、2（Re）、3(Mi)、4(Fa) 、5(Sol) 、6(La) 、7(Si)”是音乐当中的唱名，就对应了音调中的C、D、E、F、G、A、B这些音名。

 1（Do） 2（Re） 3(Mi) 4(Fa) 5(Sol) 6(La) 7(Si)

- - - - - - -

 C D E F G A B

比如程序 tone(3,262););的意思是让引脚3输出模拟值为262的脉冲，即对应音调1（D0）;同理2（Re）、3(Mi)、4(Fa) 、5(Sol) 、6(La) 、7(Si)的音调分别对应输出模拟值为294，330，349，196，440，494的脉冲。

频率（音调）高低判断时先看后面的数字，数字越大，音调越高，数字相同时看前面的字母，从C到B频率（音调）越来越高；而节拍是音符延时时间，数值越大，延时时间越长。这里我按照“生日快乐歌”来设计了音调和节拍，我们先来看它的简谱：

![](media/3e77a4a9a0e77dda64f956a232d73afb.jpeg)

节拍是指每个音符持续的时间。音谱中不带线的一个音符就是一拍，延时1000毫秒，而带一条下划线的音符节拍是不带线音符节拍的1/2，带两条下划线的音符节拍是不带线音符节拍的1/4（动画：![](media/9280991ebf66dac53c3d692cb6acf2cf.png)，根据对话圈出相应的音符和标注）。
例如：第一个音符下面有两条线，所以就是1/4拍，延时250毫秒。

### 第5课 太阳能与USB充电锂电池电源模块

1.实验介绍：

本模块集成一片充放电芯片，通过PH2.0MM接口可以外接可充电电池，我们使用了单节锂电池。模块有一个micro USB充电口与一个太阳板充电口，通过任意一个口都可以对外接的锂电池进行充电。模块上也集成一个升压模块，可将电池电压升到6.6V。通过3P黄色弯排针G、V脚可以输出6.6V电压，排针的S脚可以读取电阻1/2分压后的电池电压，模块上的拨动开关就是3P弯针6.6V的电压输出开关。

2.模块规格参数：

 充电接口 Micro USB 与 HP2.0MM太阳能板接口

 太阳能板接口输入电压 4.4-6V

 电池恒压充电值 4.15-4.24V

 最大充电电流 800mA

 输出接口 3 P 2.54mm 弯针排针

 输入电压 6.6V

 最大输出电流 1A

 外接电池 单节锂电池

 环保属性 ROHS

3.模块的原理图

![](media/189777dcc6b180028d01671c2ea49186.png)

4.模块的简单功能：

![](media/07e545ee5517782911cb24aac7b87a2d.png)SOLAR4.8-6.0V
端是接太阳能板，太阳能通过太阳能板转化成电能，是电源输入端。

![](media/ca26c0fdc91084511b3d9a948df1fd66.png)BAT端是接电池盒（可充电电池）的，是电源输出端，给电池充电，可将电能储存在电池内。

![](media/252c3ee03fefe739a910924413f1cc62.png)这个拨动开关是电源开关，拨到ON端是接通外接单节锂电池，这样单节锂电池的电压通过模块升压到6.5V从G、V引脚流向Plus
开发板，给开发板供电；反之，拨到OFF端是断开外接单节锂电池的电流。

![](media/92b0c19b4eab104090d92d8c8c7b8391.png)通过microUSB线连接到USB接口和电脑是可以给外接单节锂电池充电的。

### 第6课 按键控灯

1.1 项目介绍：

按键模块按下我们的单片机读取到低电平，松开读取到高电平。在这一实验课程中，我们利用按键和RGB做一个扩展，当按键按下时即读取到低电平时我们点亮RGB灯，松开按键时即读取到高电平时我们熄灭RGB灯，这样就可以通过一个模块控制另一个模块了。

1.2 模块相关资料：

![](media/a51debfc8a38d0d5729d1da394f95ca5.png)附原理图，按键有四个引脚，其中1和3是相连的，2和4是相连的，在我们未按下按键时，13与24是断开的，信号端S读取的是被4.7K的上拉电阻R1所拉高的高电平，而当我们按下按键时，13和24连通。信号端S连接到了GND，此时读取到的电平为低电平，即按下按键，传感器信号端为低电平；松开按键时，信号端为高电平。

1.3 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/2f08910a148456221ea40ed2630e5ef2.png) ![](media/0b475062a35179a5895b47951b109e90.png) ![](media/460ac57f07288dccd35285b8f8b2bd6f.png) ![](media/2c5a756c09457d60dedbe7c9e602d011.png)

 控制板 * 1 扩展板 * 1 USB线*1 3P 转杜邦线母*1 RGB灯*1 按键*1

1.4模块接线图：

![](media/97428e936e34e38603bf4573493c68bc.png)

1.5测试代码：

```
/*
  Keyes Arduino 智能家居套装
  课程6
  按键控制RGB灯
  http://www.keyes-robot.com
*/
#include <Wire.h>
#include <Adafruit_NeoPixel.h>
Adafruit_NeoPixel  rgb_display(8);  //定义一个像素的类
int inpin = 4; //定义按键的管脚接数字口4
int val = 0; 

void setup ()
{
  rgb_display.begin();  //启动6812RGB
  rgb_display.setPin(13);  //设置6812管脚接数字口13
  rgb_display.setBrightness(100); //设置亮度为100，范围为0~255
  pinMode (inpin, INPUT); // 按键的管脚接数字口4并设置为输入模式
}
void loop ()
{
  val = digitalRead (inpin); // 读取按键值
  if (val == LOW) //按键按下时
  {
    rgb_display.setPixelColor(0, 255, 0, 0); //第一颗灯珠亮红色
    rgb_display.setPixelColor(1, 0, 255, 0); //第二颗灯珠亮绿色
    rgb_display.setPixelColor(2, 0, 0, 255); //第三颗灯珠亮蓝色
    rgb_display.setPixelColor(3, 255, 255, 255); //第四颗灯珠亮白色
    rgb_display.show(); //显示灯珠颜色
  }
  else
  {
    rgb_display.setPixelColor(0, 0, 0, 0); //第一颗灯珠亮红色
    rgb_display.setPixelColor(1, 0, 0, 0); //第二颗灯珠亮绿色
    rgb_display.setPixelColor(2, 0, 0, 0); //第三颗灯珠亮蓝色
    rgb_display.setPixelColor(3, 0, 0, 0); //第三颗灯珠亮蓝色
    rgb_display.show();
  }
}
```

1.6实验结果：

上传测试代码成功，上电后，当我们按下智能家居**⑪号位置**的按键，RGB灯被点亮，松开按键，RGB灯熄灭。

1.7代码说明:

digitalRead(button):读取按键的数字电平，高HIGH或者低LOW。如果该引脚未连接任何东西，则digitalRead（）可以返回HIGH或LOW（并且可以随机更改）

if..else..语句：当if后面（）的逻辑判断为真时，执行大括号里的代码；否则执行else后面{}里的代码。

### 第7课 光控灯

1.1 项目介绍：

在这个套件中，有一个Keyes DIY电子积木
光敏电阻传感器，这是一个常用的光敏电阻传感器，它主要采用光敏电阻元件。该电阻元件电阻大小随着光照强度的变化而变化，该传感器就是利用光敏电阻元件这一特性，搭建电路将电阻变化转换为电压变化。光敏电阻传感器可以模拟人对环境光线的强度的判断，可广泛应用于各种光控电路，如对灯光的控制、调节等场合，也可用于光控开关。

实验中，我们将传感器信号端(S端)输入到arduino系列单片机的模拟口，感知模拟值的变化，在串口监视器上显示出对应的模拟值，当小于某个值时点亮LED灯。

1.2 模块相关资料：

![](media/0a804f6b1ccb475325301d7c9c94f38d.png)

 工作电压: DC 3.3-5V

 工作电流： &lt; 20mA

 最大功率： 0.1W

 控制接口: 输出信号：模拟信号

 工作温度： -10°C ~ +50°C

原理图分析：当没有亮光时，电阻大小为0.2MΩ，信号端（2点）检测的电压接近0，当随着光照抢度增大，光线传感器的电阻值越来越小，所以信号端检测的电压越来越小。

1.3 实验组件：

 ![](media/d0f550f884a142276ec7c7b2af1a24a6.png) ![](media/d9e1fe718dc1e390674bea8857b5e16a.jpeg) ![](media/6c14334b97f965614e1d2130b699d649.png) ![](media/0b475062a35179a5895b47951b109e90.png) ![](media/afab8252a555789a9656cae12d5b3ce3.png) ![](media/a9a7938da6f59aefa989e7f44a1c5afe.png)

 控制板 * 1 扩展板 * 1 USB线*1 3P 转杜邦线母*2 黄色LED模块* 1 Keyes 光敏电阻传感器*1

1.4模块接线图：

![](media/d1631430706d358a4194440a97ec4770.png)

1.5测试代码：

```
/*
  Keyes Arduino 智能家居套装
  课程 7
  光控灯
  http://www.keyes-robot.com
*/
int LED = 5; // 定义LED引脚D5
int val = 0; 
void setup () 
{
       pinMode (LED, OUTPUT); //设置模式为输出
       Serial.begin (9600); // 设置波特率为9600
}
void loop () 
{
       val = analogRead (A1); // 读取光敏传感器数值
       Serial.println (val); // 串口显示光敏传感器读取到的数值
       if (val <300)
       {// 当数值小于300时，点亮LED灯
       	digitalWrite (LED, HIGH);
       } 
       else 
       {//否则熄灭LED灯
       	digitalWrite (LED, LOW);
       }
       delay (10); // 延时10ms
} 
```

1.6实验结果：

按照上图接好线，上传好程序，利用USB线上电后，设置波特率为9600，我们看到在串口显示器中打印出光敏传感器测到的值，光敏电阻传感器测到的值小于等于300时，则黄色LED亮；反之，黄色LED不亮。

![](media/c766a66b4bd4a93ad2715ab0fbaf7612.png)

1.7代码说明:

1.  analogRead(pin)这个函数从指定的模拟引脚pin读取值。 Arduino板包含一个多通道、10 位模数转换器。 这意味着它会将 0 和工作电压（5V     或 3.3V我们这里是5V）之间的输入电压映射为 0 和 1023     之间的整数值。例如，在 Arduino UNO     上，这会产生以下读数之间的分辨率：5 伏/1024 单位即每单位 0.0049 伏(4.9 mV)。在基于 ATmega     的板卡（UNO、Nano、Mini、Mega）上，读取模拟输入大约需要 100     微秒（0.0001 s），因此最大读取速率约为每秒 10,000 次。
    
2.  pin：要读取的模拟输入引脚的名称（大多数板上的A0到A5，我们plus板上的A0到A7，Mega2560上的A0到A15）。设置1个整数变量item，将所测结果赋值给item。函数返回值为引脚上的模拟读数。虽然它受限于模数转换器的分辨率（0-1023     为 10 位或 0-4095 为 12 位）。数据类型：int。

3.  串口监视器显示analogVal 的值，显示前需设置波特率（我们默认设置为9600，可更改）。

### 第8课 小风扇转动

1.1 项目介绍：

130电机控制模块采用HR1124S电机控制芯片。HR1124S是应用于直流电机方案的单通道H桥驱动器芯片。HR1124S的H桥驱动部分采用低导通电阻的PMOS和NMOS功率管。低导通电阻保证芯片低的功率损耗，使得芯片安全工作更长时间。此外HR1124S拥有低待机电流，低静态工作电流，这些性能使HR1124S易用于玩具方案。

该模块兼容各种单片机控制板，如arduino系列单片机。模块上自带的防反插红色端子间距为2.54mm，实验中，我们可通过输出到两个信号端IN+和IN-的电压方向来控制电机的转动方向，让电机转动起来。

1.2 模块相关资料：

 工作电压： 3.3-5V(DC) 最大电流： 200mA (DC5V)

 最大功率： 1W 控制接口： 双数字口（数字输入）

 工作温度： -10°C ~+50°C 环保属性： ROHS

![](media/2498f64be175011ed8b3263749146e4f.png)

1.3 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/6c14334b97f965614e1d2130b699d649.png) ![](media/800d881ecb0dd004ec0d9695d78fec42.png) ![](media/108172d6f4c8219eb6d9455b9a1aacae.png)

 控制板 * 1 扩展板 * 1 USB线*1 Keyes DIY电子积木 130电机模块*1 4P 转杜邦线母*1

1.4模块接线图：

![](media/d2cd51b65c5d48128d268427f0b8858f.png)

1.5测试代码：

```
/*
  Keyes Arduino 智能家居套装
  课程 8
  小风扇转动
  http://www.keyes-robot.com
*/
//定义电机的两个管脚接口，分别为6、7
int INA = 6;
int INB = 7;
void setup() 
{
  //设置电机引脚为输出
  pinMode(INA, OUTPUT);
  pinMode(INB, OUTPUT);
}

void loop() 
{
  //逆时针转
  digitalWrite(INA, HIGH);
  digitalWrite(INB, LOW);
  delay(2000);
  //停止
  digitalWrite(INA, LOW);
  digitalWrite(INB, LOW);
  delay(1000);
  //顺时针转
  digitalWrite(INA, LOW);
  digitalWrite(INB, HIGH);
  delay(2000);
  //停止
  digitalWrite(INA, LOW);
  digitalWrite(INB, LOW);
  delay(1000);

}
```



1.6实验结果：

烧录好测试程序，打开电源开关后，风扇顺时针转动2秒；停止1秒；逆时针转动2秒；停止1秒；循环交替。

1.7代码说明:

将管脚设置为6、7，当6输出为低电平即INA输入低电平，7输出为高电平即INB输入高电平时（输入与输出是相对的，这个实验中对于我们单片机的引脚来说，单片机输出高低电平，自然模块就为输入了，即从单片机输出到模块；例如按键模块则相反，是模块输出到单片机），电机顺时针旋转；当6输出为高电平，7输出为低电平时，电机逆时针旋转；当两个管脚都设置为低电平时，电机停止转动。

### 第9课 控制舵机

1.1 项目介绍：

![](media/69be958142b773acdae33eeef12afed7.png)

当我们在制作智能家居时，经常会将舵机和门、窗等固定在一起。这样，我们就可以利用舵机转动，带动门、窗等开或关，从而起到家居生活的智能化功能。在这课程中我们着重介绍下智能家居套件中的舵机的原理和使用方法。

舵机是一种位置伺服的驱动器，主要是由外壳、电路板、无核心马达、齿轮与位置检测器所构成。与马达不同，我们一般控制马达的转速和方向。而舵机更多的是控制指定的角度。常用的舵机可旋转的角度范围是0°到180°。舵机引线为3线，分别用棕、红、橙三种颜色进行区分，舵机品牌和生产厂家不同，会有些许差异，使用之前需查看资料。我们使用的是最常见的舵机，棕、红、橙分别对应“电源负极，电源正极，控制信号”。

1.2 舵机相关资料：

舵机的伺服系统由可变宽度的脉冲来进行控制，橙色的控制线是用来传送脉冲的。一般而言，PWM控制舵机的基准信号周期为20ms（50Hz），理论上脉宽应在1ms到2ms之间，对应控制舵机角度是0°～180°。但是，实际上更多控制舵机的脉宽范围是0.5ms
到2.5ms，具体需要自己实际调试下。

![](media/0982cb7b28f4accde7d378ba812c8bcb.png)

经过实测，舵机的脉冲范围为0.65ms~2.5ms。180度舵机，对应的控制关系是这样的：

 高电平时间 舵机角度 基准信号周期时间（20ms）

 0.65ms 0度 0.65ms高电平+19.35ms低电平

 1.5ms 90度 1.5ms高电平+18.5ms低电平

 2.5ms 180度 2.5ms高电平+17.5ms低电平

舵机的规格参数：

 工作电压： DC 4.8V〜6V 可操作角度范围： 大约180°(在500→2500μsec)

 脉波宽度范围： 500→2500 μsec 外观尺寸： 22.9*12.2*30mm

 空载转速：0.12±0.01 sec/60度（DC 4.8V） 0.1±0.01 sec/60度（DC 6V）

 空载电流：200±20mA（DC 4.8V） 220±20mA（DC 6V）

 停止扭力：1.3±0.01kg·cm（DC 4.8V） 1.5±0.1kg·cm（DC 6V）

 停止电流：≦850mA（DC 4.8V） ≦1000mA（DC 6V）

 待机电流：3±1mA（DC 4.8V） 4±1mA（DC 6V）

 重量:9±1g (without servo horn)

 使用温度：-30℃~60℃

1.3 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/6c14334b97f965614e1d2130b699d649.png) ![](media/b9a9b948b21541e2423daa90ece6dfe6.png)

 控制板 * 1 扩展板 * 1 USB线*1 180度舵机*1

1.4模块接线图：

![](media/eb8f2ecef10ac4850dedd5b18e27cb14.png)

1.5测试代码：

```
/*
  Keyes Arduino 智能家居套装
  课程 9
  伺服舵机-库函数
  http://www.keyes-robot.com
*/
#include <Servo.h>  //舵机库
Servo myservo;
void setup() 
{
  myservo.attach(9);//舵机连接数字口9
}

void loop() 
{
  for (int pos = 0; pos < 180; pos++) 
  {
    myservo.write(pos); //转动到pos角度
    delay(15);  //加延时转慢一点
  }
  for (int pos = 180; pos > 0; pos--) 
  {
    myservo.write(pos);
    delay(15);
  }
  delay(2000);//等待2秒
}
```

1.6实验结果：

上传测试代码成功，外接电源开关打开后，“智能家居的门”0~180度来回转动，并且每15ms转动一度。

1.7 项目拓展：

我们不调用舵机库能控制？当然能，如下就是不调用舵机库的程序，上传测试程序成功，外接电源开关打开后，“智能家居的门”由0度，90度，180度三个角度循环转动。

```
/*
  Keyes Arduino 智能家居套装
  课程 9
  伺服舵机-2
  http://www.keyes-robot.com
*/
int servoPin = 9;//舵机的PIN

void setup() 
{
  pinMode(servoPin, OUTPUT);//舵机引脚设置为输出
}
void loop()
{
  servopulse(servoPin, 0);//转动到0度
  delay(1000);//延时1秒
  servopulse(servoPin, 90);//转动到90度
  delay(1000);
  servopulse(servoPin, 180);//转动到180度
  delay(1000);
}

void servopulse(int pin, int myangle) 
{ //脉冲函数
  int pulsewidth = map(myangle, 0, 180, 500, 2500); //将角度映射到脉宽
  for (int i = 0; i < 5; i++) 
  { //多输出几次脉冲
    digitalWrite(pin, HIGH);//将舵机接口电平至高
    delayMicroseconds(pulsewidth);//延时脉宽值的微秒数
    digitalWrite(pin, LOW);//将舵机接口电平至低
    delay(20 - pulsewidth / 1000);
  }
}

```

1.8代码说明:

代码1：

(1)首先我们先添加舵机库![](media/2b400a28e6c9279905c0369fbf52b9ce.png)，不然编译出错。

(2)这个库的方法**.attach()**方法是连接舵机引脚，我们连到9，10也可以，这里面用到了定时器，使用其他管脚可能会出现冲突。

(3)myservo.write(pos)**为转动到pos角度值。**myservo.read()是读取舵机当前角度值。

代码2：

（1）map(value, fromLow, fromHigh, toLow, toHigh)；value为我们要映射的值；fromLow, fromHigh为当前值的下限和上限；toLow, toHigh为我们要映射到的目标范围的下限和上限。比如我们在实验中map(myangle, 0, 180, 500, 2500)的意思就是我们传进来一个需要转动的角度值为myangle，然后这个值的范围是0度到180度，我们要映射的范围为500us到2500us，即把0到180转到了500到2500然后被返回了，返回的数据类型为整型，余数会被截断，不进行四舍五入或平均。

（2）
之后我们调用我们定义的的函数servopulse（）就能让舵机转动了，代码中我们设置了让舵机从0度转动到90度再转动到180度，再转动到0度，中间暂停一秒，反复循环。

### 第10课 水滴警报

1.1 项目介绍：

![](media/389486699548b77a36f4d16b660b3595.png)这是一个常用的水滴水蒸气传感器。它的原理是通过电路板上裸露的金属花纹区检测水量的大小。水量越多，就会有更多的导线被联通，随着导电的接触面积增大，输出的电压就会逐步上升。除了可以检测水量的大小，它还可以检测空气中的水蒸气。即：水滴传感器是一种模拟传感器，可以作为一个简单的雨水探测器和液位开关。当传感器表面的湿度升高时，输出电压将升高，读取到的模拟值即增大。

该传感器兼容各种单片机控制板，如Arduino系列单片机。实验中，将传感器信号端输入到开发板的模拟口，感知模拟值的变化，并在串口监视器上显示出对应的模拟值，当数值达到某一数值时控制蜂鸣器发声。

1.2 模块相关资料：

 工作电压： DC 3.3-5V ![](media/3b0760476232188966281131ba9da7e5.png)

 工作温度范围： －10℃～＋70℃

 最大工作电流： 5uA (DC5V，或者当水滴传感器两脚直接短接)

 控制接口： 模拟输出

1.3 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/3e05cae18da9549123032b0bd479d866.png) ![](media/389486699548b77a36f4d16b660b3595.png) ![](media/0b475062a35179a5895b47951b109e90.png)

 控制板 * 1 扩展板 * 1 无源蜂鸣器模块 水滴水蒸气传感器模块*1 3P 转杜邦线母*2

1.4模块接线图：

![](media/d76aaabc1d6d47760d4bed48e6bdde64.png)

1.5测试代码：

```
/*
  Keyes Arduino 智能家居套装
  课程10
  水滴报警器
  http://www.keyes-robot.com
*/
int val = 0;
void setup() {
  pinMode(3, OUTPUT);//无源蜂鸣器接D3
  Serial.begin(9600); //设置波特率为9600
}

void loop() {
  val = analogRead(A2);//读取水滴模拟值
  Serial.println(val);
  if (val > 700) {//模拟值大于800
    tone(3, 392);         //控制引脚3输出模拟值为262的脉冲
    delay(125);         //延迟125毫秒
    tone(3, 392);
    delay(125);
  }
  else {//否则蜂鸣器停止发声
    noTone(3);
  }

}
```

1.6实验结果：

上传好测试程序，打开Arduino智能家居的电源开关，打开串口显示窗口，设置波特率为9600，我们看到在串口显示器中打印水滴传感器测到的湿度模拟值，传感器表面的湿度升高时，输出电压将升高，读取到的模拟值即增大，当大于700时，无源蜂鸣器发声警报。

![](media/2c82e9fecb66d8304924aed43083b8eb.png)

### 第11课 人体红外传感器实验

1.1 项目介绍：

人体红外热释电传感器是一款基于热释电效应的人体热释电红外运动传感器，能检测运动的人体或动物身上发出的红外信号，配合菲涅尔透镜能使传感器探测范围更远更广。它主要采用RE200B-P传感器元件，当附近有人或动物运动时，人体红外热释电传感器能根据检测到的红外线，将红外线信号转化为数字信号并输出一个高电平。它可以应用于多种场合来检测人体的运动。传统的热释电红外传感器体积大，电路复杂，可靠性低。

现在我们推出这款一款新的热释电红外运动传感器，该传感器集成了数字热释电红外传感器和连接管脚。具有灵敏度高、可靠性强、超低功耗，体积小、重量轻，超低电压工作模式和外围电路简单等特点。

1.2 模块相关资料：

 工作电压： DC 4.5-6.5V ![](media/ee515734c07dde5b3e5c06f3916e6b74.png)

 最大工作电流： 50MA

 静态电流: &lt;50uA

 控制接口： 数字输出(高电平为3.3V
，低电平0V)

 控制信号： 数字信号1/0

 工作温度： -10 ~ 50 ℃

 最大探测距离： 4米

 感应角度： ＜100°锥角

 触发方式: L 不可重复触发/H 重复触发

1.3 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/8ac56c538ca2e98083ea5eb62153962b.png) ![](media/c534cfb8208e124fcca590ef2b36b266.png) ![](media/800d881ecb0dd004ec0d9695d78fec42.png)

 控制板 * 1 扩展板 * 1 人体红外热释传感器*1 黄色LED模块*1 130电机模块*1

 ![](media/108172d6f4c8219eb6d9455b9a1aacae.png) ![](media/0b475062a35179a5895b47951b109e90.png) ![](media/6c14334b97f965614e1d2130b699d649.png)  

 4P 转杜邦线母*1 3P 转杜邦线母*2 USB线*1  

1.4模块接线图：

![](media/8f2278fcf8b5922609ed48b840b7f140.png)

1.5测试代码：

```
/*
 Keyes  Arduino智能家居套装
 第11课
 人体红外传感器
 www.keyes-robot.com
*/

void setup () 
{
   Serial.begin (9600); // 波特率9600
   pinMode (3, INPUT); // 定义人体红外传感器引脚D2,并设置为输入模式
   pinMode (5, OUTPUT); // 定义LED引脚D5,并设置为输出模式
   pinMode (7, OUTPUT); // 定义小风扇INB引脚D7,并设置为输出模式
   pinMode (6, OUTPUT); // 定义小风扇INA引脚D6,并设置为输出模式
}

void loop () 
{
   Serial.println (digitalRead (3));
   delay (500); // 延时 500ms
   // 如果检测到有人，黄色LED灯点亮，小风扇转动
   if (digitalRead (3) == 1) 
   {
     digitalWrite (5, HIGH); 
     digitalWrite (7, HIGH);
     analogWrite (6,150); 

   } 
   else //否则黄色LED灯熄灭，小风扇停止转动
   {
     digitalWrite (5, LOW); 
     digitalWrite (7, LOW);
     analogWrite (6,0); 
   }
}
```

1.6实验结果：

上传好代码，打开串口监视器，设置波特率为9600，如果人体红外热释电传感器检测到人体在附近运动时，串口监视器上显示数字信号1，同时外接在数字引脚5的黄色LED将亮起，小风扇转起；如果未检测到人体在附近运动时，串口监视器上显示数字信号0，同时外接在数字引脚5的黄色LED不亮，小风扇停止转起。

![](media/3b988e707ad31a84c88393b3b00c065c.png)

### 第12课 MQ2模拟气体传感器实验

1.1 项目介绍：

![](media/c863ecfd743457d03ae742c4011ef7fb.png)气体传感器（MQ-2）可用于家庭用气体泄漏报警器、工业用可燃气体报警器以及便携式气体检测仪器，适宜于液化气、苯、烷、酒精、氢气、烟雾等的探测，被广泛运用到各种消防报警系统中。故因此，气体传感器（MQ-2）可以准确来说是一个多种气体探测器，同时还具有灵敏度高、响应快、稳定性好、寿命长、驱动电路简单等优点。

气体传感器（MQ-2）检测可燃气体与烟雾的浓度范围是300~10000ppm，对天然气、液化石油气等烟雾有很高的灵敏度，尤其对烷类烟雾更为敏感。在使用之前必须加热一段时间，这样输出的电阻和电压较准确。但是加热电压不宜过高，否则会导致内部的信号线熔断。

模拟气体（MQ-2）传感器属于二氧化锡半导体气敏材料，属于表面离子式N型半导体。处于200~300摄氏度时，二氧化锡吸附空气中的氧，形成氧的负离子吸附，使半导体中的电子密度减少，从而使其电阻值增加。当与空气中可燃气体和烟雾烟雾接触时，如果晶粒间界处的势垒收到烟雾的调至而变化，就会引起表面导电率的变化。利用这一点就可以获得烟雾或可燃气体存在的信息，空气中烟雾或可燃气体的浓度越大，导电率越大，输出电阻越低，则输出的模拟信号就越大。

此外，通过旋转电位器可以调整气体传感器（MQ-2）灵敏度。上电后，传感器上的一个指示灯亮绿灯，并且还可以调节蓝色的正方体电位器，使模块上另一个指示灯介于不亮与亮之间的临界点时，灵敏度最高。

1.2 模块相关资料：

 工作电压： 5V ![](media/42a27e658a946a1d9845c5846db4b412.png)

 工作电流： 160mA (DC5V)

 工作温度： 0°C ~ 40°C

 控制接口： 数字、模拟输出

 检测浓度： 300-10000ppm(可燃气体)

 浓度斜率： ≤0.6(R3000ppm/R1000ppm C3H8)

 灵敏度： Rs(in air)/Rs(1000ppm异丁烷)≥5

 敏感体表面电阻（Rs） 2KΩ-20KΩ(in 2000ppm C3H8 )

1.3 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/c863ecfd743457d03ae742c4011ef7fb.png) ![](media/3e05cae18da9549123032b0bd479d866.png) ![](media/0b475062a35179a5895b47951b109e90.png) ![](media/5728784721ceea6af7bf57d5a3e7fca9.png)

 控制板 * 1 扩展板 * 1 MQ2传感器*1 无源蜂鸣器模块*1 3P 转杜邦线母*1 4P 转杜邦线母*1

1.4模块接线图：

![](media/06f471524ee878e439f20b16a48fb85c.png)

1.5测试代码：

```
/*
 Arduino 智能家居套装
 第12课 MQ2气体传感器
 www.keyes-robot.com
*/
int MQ2 = A0; // 在A0处定义MQ2气体传感器引脚
int val = 0; // 声明变量
int buzzer = 3; // 定义D3处的蜂鸣器引脚
void setup ()
{
  pinMode (MQ2, INPUT); // MQ2气体传感器作为输入
  Serial.begin (9600); // 将串行端口波特率设置为9600
  pinMode (buzzer, OUTPUT); // 设置输出的数字IO引脚模式
}
void loop ()
{
  val = analogRead (MQ2); //读取A0端口的电压值并将其分配给val
  Serial.println (val); // 串口显示val值
  if (val> 450)
  {
    tone (buzzer, 589);
    delay(300);
  }
  else
  {
    noTone (buzzer);
  }
}
```

1.6实验结果：

按照上图接线，烧录好程序，上电后，气体传感器检测到可燃性气体数值在监视窗口上显示，当数值大于450时(可以用打火机气体测试)无源蜂鸣器鸣叫；否则无源蜂鸣器不发出声音。

![](media/ccfc3cdac0a70e4d75a9a0376f007209.png)

### 第13课 XHT11温湿度传感器

1.1 项目介绍：

![](media/b6a80d0bcb968495fa23c322ad305cbc.png)XHT11温湿度传感器（XHT11完全兼容DHT11）是一款含有已校准数字信号输出的温湿度复合传感器，其精度：湿度±5%RH，
温度±2℃；量程：湿度20-90%RH，
温度0~50℃。XHT11温湿度传感器应用专用的数字模块采集技术和温湿度传感技术，确保产品具有极高的可靠性和卓越的长期稳定性。XHT11温湿度传感器包括一个电阻式感湿元件和一个NTC测温元件，非常适用于对精度和实时性要求不高的温湿度测量场合。

XHT11有三个引脚，分别为V，G，和S。S为数据输出的引脚，使用的是串行通讯。

1.2 模块相关资料：

 工作电压： 3.3V-5V（DC） ![](media/f09e0e21724d59f74375c2b0c6cffd19.png)

 最大工作电流： 50mA

 最大功率： 0.25W

 控制接口： 数字双向单总线

 温度范围： 0-50℃（±2℃）

 湿度范围： 20-90%RH（±5%RH）

 工作温度： -25℃~+60℃

XHT11温湿度传感器的单总线格式定义：

 名称:单总线格式定义

 起始信号:微处理器把数据总线（SDA）拉低一段时间至少 18ms（最大不得超过30ms），通知传感器准备数据。

 响应信号：传感器把数据总线（SDA）拉低 83µs，再接高 87µs以响应主机的起始信号。

 湿度：湿度高位为湿度整数部分数据，湿度低位为湿度小数部分数据

 温度：温度高位为温度整数部分数据，温度低位为温度小数部分数据，且温度低位Bit8 为 1 则表示负温度，否则为正温度。

 校验位：校验位＝湿度高位+湿度低位+温度高位+温度低位

HT11温湿度传感器数据时序图：用户主机（MCU）发送一次开始信号后，XHT11从低功耗模式转换到高速模式，待主机开始信号结束后，XHT11发送响应信号，送出 40bit 的数据，并触发一次信采集。信号发送如图所示。

![](media/c3038afcfc88d77da5ce9e8facf8ef32.png)

1.3 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/6c14334b97f965614e1d2130b699d649.png) ![](media/b6a80d0bcb968495fa23c322ad305cbc.png) ![](media/0b475062a35179a5895b47951b109e90.png)

 控制板 * 1 扩展板 * 1 USB线*1 XHT11传感器*1 3P 转杜邦线母*1

1.4模块接线图：

![](media/8fddd93551b7565e96944bf2a4e54478.png)

1.5测试代码：

```
/*
  Keyes Arduino 智能家居套装
  课程 13
  DHT11温湿度传感器
  http://www.keyes-robot.com
*/
#include <dht11.h>  //include the library code:
dht11 DHT;
#define DHT11_PIN 12 //定义DHT11为数子口12

void setup() 
{
  Serial.begin(9600);
}
void loop() 
{
  int chk;
  chk = DHT.read(DHT11_PIN);    // READ DATA
  switch (chk) 
  {
    case DHTLIB_OK:
      break;
    case DHTLIB_ERROR_CHECKSUM: //校检和错误返回
      break;
    case DHTLIB_ERROR_TIMEOUT: //超时错误返回
      break;
    default:
      break;
  }
  // DISPLAT DATA
  Serial.print("humidity:");
  Serial.print(DHT.humidity);
  Serial.print("   temperature:");
  Serial.println(DHT.temperature);
  delay(200);
}
```

1.6实验结果：

上传测试代码成功，利用USB线上电后，打开串口监视器，设置波特率为9600。串口监视器显示当前环境中的温湿度数据，如下图：

![](media/9391c38f5f339c419e9d4e52e6c3e994.png)

1.7代码说明:

1\. 在实验中，我们需要先导入DHT11的库文件。

2\.我们把管脚设置为3，**DHT.temperature**获取温度和**DHT.humidity**获取湿度。

3\. 设置两个小数变量，分别为val1和val2，将所测结果赋值给val1和val2。

4.串口监视器显示val1和val2的值，显示前需设置波特率（我们默认设置为9600，可更改）。

5.显示时，我们在数据后面添加单位。如果温度单位直接设置为℃，测试结果可能出现乱码，所以我们直接用C代替℃；湿度单位直接设置为%。

### 第14课 LCD1602显示

1.1 项目介绍：

![](media/08b5cb8ff7fe33229395a4e9b1a5d0db.jpeg)Keyes I2C 1602 LCD模块是可以显示2行，每行16个字符的液晶显示器模块。液晶显示器显示蓝底白字，自带I2C通信模块，使用时只需连接单片机I2C通信接口，大大节约了单片机资源。最初的1602 LCD需要7个IO端口来启动和运行，而Keyes I2C 1602 LCD模块内置Arduino IIC/I2C接口，节省了5个IO端口。和Arduino液晶库文件兼容，用起来很简单。

LCD非常适合打印数据和显示数字。可以显示32个字符(16x2)。在Keyes I2C 1602 LCD模块的背面有一个蓝色的电位器，可以转动电位器来调整对比度。**连接时请注意，LCD的GND和VCC不能接反，否则会损坏LCD。**

1.2 模块相关资料：

 工作电压： DC5V I2C地址： 0x27 控制接口： I2C

 工作电流： &lt; 130mA 工作环境温度： 0°C ~ 45°C（推荐） 驱动芯片： PCF8574T

GND：一个接地的引脚

VCC：一个连接到+5V电源的引脚

SDA：一个连接到SDA（或A4）的引脚，用于IIC通信

SCL：一个连接到SCL（或A5）的引脚，用于IIC通信

背光（蓝底白字）

可调对比度

1.3 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/1e1f80aa6fe9ac8e5a20ae9cbbe30363.png) ![](media/108172d6f4c8219eb6d9455b9a1aacae.png)

 控制板 * 1 扩展板 * 1 Keyes LCD1602模块* 1 4P 转杜邦线母*1

1.4模块接线图：

![](media/d468f9879762dd5d9603584cdc62d5c3.png)

1.5测试代码：

```
/*
 Arduino 智能家居套装
 第14课 
 1602 LCD显示
 www.keyes-robot.com
*/
#include <Wire.h>
#include <LiquidCrystal_I2C.h>
LiquidCrystal_I2C lcd (0x27,16,2); //16个字符和2行显示，LCD IIC地址为0x27
void setup ()
{
    lcd.init (); //初始化
    lcd.backlight ();//LCD清屏
    //在（2，1）的位置显示Hello, world!
    lcd.setCursor (2,1);
    lcd.print ("Hello, world!");
    //在（5，0）的位置显示keyes!
    lcd.setCursor (5,0);
    lcd.print ("keyes");
}
void loop ()
{
}
```

1.6实验结果：

上传好程序，打开Arduino智能家居的电源开关,LED1602显示屏第一行显示keyes；第二行显示Hello,world!

![](media/0d764267475b59891c3bc0c2bbbaa090.png)

1.7代码说明:

1.  程序中使用了#include     \<LiquidCrystal_I2C.h\>这个库，使用前先添加库文件

    ![](media/870a4ad072866fad12120c9072d401d9.png)添加方式参考(开发环境配置)

(2)LiquidCrystal_I2C lcd (0x27,16,2):这个LCD1602可以显示2行16个字符，LCD IIC地址为0x27

lcd.init ()：LCD初始化函数

lcd.backlight ()：LCD清屏函数

lcd.print ("Hello, world!")：LCD显示内容

### 第15课 温湿度仪表

1.1 项目介绍：

在冬季时，空气中的湿度很低，就是空气很干燥，再加上寒冷，人体的皮肤就容易过于干燥而裂，所以需要再用加湿器给家里的空气增加湿度，但是怎么知道空气过于干燥了呢？那就需要检测空气湿度的设备。前面我们已经学习了XHT11温湿度传感器和LCD1602显示器，这节课我们就使用这两者结合做一个实验，让温湿度在LCD1602显示，实现温湿度仪表功能。

1.2 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/6c14334b97f965614e1d2130b699d649.png) ![](media/7a44ab558734e294abfaa6291cc37df2.png) ![](media/0b475062a35179a5895b47951b109e90.png)

 控制板 * 1 扩展板 * 1 USB线*1 XHT11传感器*1 3P 转杜邦线母*1

 ![](media/e858b94b8e802a65930d9c9f6ec40d56.png) ![](media/108172d6f4c8219eb6d9455b9a1aacae.png)   

 Keyes LCD1602模块* 1 4P 转杜邦线母*1   

1.3模块接线图：

![](media/1830df3406ec24bbfeb45e34d9696812.png)

1.4 测试代码：

```
/*
  Keyes Arduino 智能家居套装
  课程 15
  温湿度表
  http://www.keyes-robot.com
*/
#include <dht11.h>  //include the library code:
#include <Wire.h>
#include <LiquidCrystal_I2C.h>
LiquidCrystal_I2C lcd (0x27, 16, 2); //16个字符和2行显示，LCD IIC地址为0x27
dht11 DHT;
#define DHT11_PIN 12 //定义DHT11为数子口12

void setup() 
{
  lcd.init (); //初始化
  lcd.backlight ();//LCD清屏
  Serial.begin(9600);
}
void loop() 
{
  int chk;
  chk = DHT.read(DHT11_PIN);    // READ DATA
  switch (chk) 
  {
    case DHTLIB_OK:
      break;
    case DHTLIB_ERROR_CHECKSUM: //校检和错误返回
      break;
    case DHTLIB_ERROR_TIMEOUT: //超时错误返回
      break;
    default:
      break;
  }
  // DISPLAT DATA
  lcd.setCursor (0, 0);
  lcd.print ("humidity:   %");
  lcd.setCursor (0, 1);
  lcd.print ("temperature:  C");
  lcd.setCursor (10, 0);
  lcd.print (DHT.humidity);//第一行显示湿度
  lcd.setCursor (12, 1);
  lcd.print (DHT.temperature);//第二行显示温度
  Serial.print("humidity:");
  Serial.print(DHT.humidity);
  Serial.print("   temperature:");
  Serial.println(DHT.temperature);
  delay(200);
}
```

1.5实验结果：

上传好示例程序，打开Arduino智能家居的电源开关，就可以看到LCD1602显示器第一行显示湿度，第二行显示温度

![](media/7ba57575121cb9b7e0bdaab346e682bf.png)

### 第16课 蓝牙控制LED灯

1.1 项目介绍：

![](media/a01c9ddd786f537b08d7537825595892.png)DX-BT24 5.1蓝牙模块是为智能无线数据传输而打造，采用英国DAILOG公司14531芯片，配置256Kb 空间，遵循V5.1 BLE蓝牙规范。支持AT指令，用户可根据需要更改串口波特率、设备名称等参数，使用灵活。本模块支持UART接口，并支持蓝牙串口透传，具有成本低、体积小、功耗低、收发灵敏性高等优点，只需配备少许的外围元件就能实现其强大功能。

在实验中，我们默认为把蓝牙模块当做从机，手机当做主机。实验中我们在手机上安装对应的APP，在APP上连接蓝牙模块，然后通过手机APP控制智能家居的各元器件实现相应的功能和效果。为此我们还特别设计了分别支持安卓系统和mac系统的手机APP。

1.2 模块相关资料：

（1）参数

蓝牙协议：Bluetooth Specification V5.1 BLE

工作距离：在开放环境中，实现40m超远距离通讯

工作频率：2.4GHz ISM频段

通信接口：UART

蓝牙认证：符合FCC CE ROHS REACH认证标准

串口参数：9600、8数据位、1停止位、无效位、无流控

电源：5V DC

工作温度：–10至+65摄氏度

（2）应用领域：

DX-BT24 模块同时支持 BT5.1 BLE 协议，可以同具备 BLE 蓝牙功能的 iOS
设备直
接连接，支持后台程序常驻运行。主要用于短距离的数据无线传输领域。避免繁琐的线缆
连接，能直接替代串口线。BT24 模块成功应用领域：

※ 蓝牙无线数据传输； ※ 手机、电脑周边设备； ※ 手持 POS 设备；

※ 医疗设备无线数据传输； ※ 智能家居控制； ※ 蓝牙打印机；

※ 蓝牙遥控玩具； ※ 共享单车；

（3）接口说明：

![](media/cd97cf79ff5cdd5bbd78f4cc960d38e5.png)

①STATE：状态脚

②RX：接收脚

③TX：发送脚

④GND：接地脚

⑤VCC：电源脚

⑥EN：使能脚

1.3 实验组件：

 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/142dcbfeca8f44fefb1d384630d9ad6d.png) ![](media/9f4566d7799a10501c2c1b0ecd009d94.png) ![](media/0b475062a35179a5895b47951b109e90.png)

 控制板 * 1 扩展板 * 1 LED模块* 1 BT-24蓝牙*1 3P 转杜邦线母*1

1.4模块接线图：

![](media/9f9e61c57d3e9d080064cc0377cce78c.png)

注：蓝牙对好接口插上去即可

特别注意：：在上传测试代码时，不能连接蓝牙模块，需要把蓝牙模块取下，否则程序上传不成功。先上传测试代码，成功后再连接蓝牙和蓝牙模块，配对，连接APP。

1.5测试代码：

```
/*
  keyes Aduino智能家居套装
  课程16
  蓝牙控制LED
  http://www.keyes-robot.com
*/
int ledpin = 5; //定义LED接口D5
void setup()
{
  Serial.begin(9600); //设置串口波特率为9600
  pinMode(ledpin, OUTPUT);//设置LED接口为输出模式
}
void loop()
{
  char val; //val为字符型
  while (Serial.available()>0)
  {
    val = Serial.read(); //读取蓝牙发送的值
    Serial.println(val);  //串行端口打印数值
    if (val == 'a')  //当数值等于a时点亮LED灯
    {
      digitalWrite(ledpin, HIGH);
    }
    if (val == 'b') //当数值等于b时熄灭LED灯
    {
      digitalWrite(ledpin, LOW);
    }
  }
}
```



1.6 APP下载和简介

（1）安卓系统手机蓝牙APP（国内）：

下载链接：![](media/f1ebec09a6a924e66654e11bbf3e8827.png)**http://8.210.52.206/keyes-IoT.apk**

二维码下载：![](media/0f77301388c7eb740852ff9394f6ca39.png)

下载安装后打开![](media/c2c30c626d6a10fd8123780ec5847a5d.png)，出现如下图界面。。

![](media/08274943c4117b4172e281510173f3b2.png)

控制板上传代码成功后，连接蓝牙，上电后，蓝牙模块上LED闪烁。开启手机蓝牙，点击左上角的SCANING按钮，进行蓝牙搜索和连接

![](media/67876fa0baf2bee65b73a704f48532cb.jpeg)

点击连接，蓝牙BT24连接成功，显示如下图，蓝牙模块上的LED变为常亮。

![](media/b621a3eba7dfb555827d1537d8073275.jpeg)

（2）苹果系统手机（平板电脑）APP：

打开App Store。

![](media/eeccf6fd30106842b44464a3dc598f0c.png)

在APP Store上搜索IoT keyes，点击获取，下载安装APP即可。

![](media/3f729e12933a29d62cf24dde64d5c7ea.jpeg)

下载安装后打开![](media/c2c30c626d6a10fd8123780ec5847a5d.png)，出现如下图界面。

![](media/cbdbd5555560fbae02c9d45301bad4b1.png)

点击Connect，再点击BT24就可以连接上蓝牙了,此时蓝牙的红色指示灯为常亮。

![](media/042305634978f9000160dd5d405ed1b2.png)

![](media/7ee73634559c311928882818fae7b154.png)

在APP中有16个控制按键，当手机APP成功连接上BT-24蓝牙后，我们按下APP控制按键，每按下一个APP上的按键蓝牙发送一个控制字符，蓝牙模块就能接收到一个对应的控制字符，我们在编程时，根据对应按键控制字符设置智能家居各传感器或模块的对应功能。在这个实验中，我们先测试出16个按键对应的控制字符。

1.7实验结果：

上传好测试程序，如上打开APP连接上蓝牙，点击一下![](media/15a22a9e01afedb33f2f81697b0b5bb9.png)点亮黄色LED灯，再点击一下熄灭LED灯。打开串口监视器，设置波特率为9600。按下手机APP上功能按钮，我们可以看到APP上功能按钮对应的控制字符，如下图：

![](media/d47da44748f84e646b0499b4a710214d.png)

经过测试，我们得出了手机APP上各个按钮对应的控制字符和各个按钮对应的功能，这里我们整理了一个表格如下：**（说明：下图是安卓手机的APP一些操作说明界面（ios的界面基本一样））**

 按钮:![](media/00166855cc0493ef6340ab202f129959.png) 功能：配对连接HM-10蓝牙模块

 按钮:![](media/ed35b9dcb754d77970e03303a1fa730d.png) 功能：断开蓝牙连接

 按钮:![](media/0bf4845021f35c8b032ad2970d8fbf23.png) 控制字符：点一下发送 “a”；
再点一下发送“b”。

 按钮:![](media/8bbee596be00faa43666dbc89fef52ef.png) 控制字符：点一下发送 “c”；
再点一下发送“d”。

 按钮:![](media/2009acb4732995cc83b7fe0ede2a9998.png) 控制字符：按住发送 “e”；
松开发送“g”。

 按钮:![](media/f0e6081acc58cfd204f416d60656a493.png) 控制字符：按住发送 “f”；
松开发送“g”。

 按钮:![](media/fd82561fc16273f0e366af7df0c06ec4.png) 控制字符：点一下发送 “h”；
再点一下发送“S”。

 按钮:![](media/df457bfb68d5ee93c82bd0a1b8538440.png) 控制字符：点一下发送 “i”；
再点一下发送“S”。

 按钮:![](media/8220b10511d721d55ce50a8e594cce09.png) 控制字符：点一下发送 “j”；
再点一下发送“S”。

 按钮:![](media/c6892e6f550052216348cafa20dd705d.png) 控制字符：点一下发送 “k”；
再点一下发送“S”。

 按钮:![](media/027da5a4bb50c846211290d128a26814.png) 控制字符：点一下发送 “l”；
再点一下发送“m”。

 拖动条:

![](media/b2c91a6d1b3d2c7725ab5b45b7d75969.png) 控制字符：拖动拖动条松开时发送“t 50
#”，字符‘t’表示起始字符；数字50表示舵机1的角度；字符‘#’表示终止字符。

 按钮:![](media/29180fb7638890a0ffb098743ff08384.png) 控制字符：点一下发送 “n”；
再点一下发送“o”。

 拖动条:

![](media/9b9b4b0d56f15dd4f3aac08a57dc1dbd.png) 控制字符：拖动拖动条松开时发送“u 34
#”，字符‘u’表示起始字符；数字34表示舵机2的角度；字符‘#’表示终止字符。

 按钮:![](media/0b9f125d6da42737ff3eae79f5378973.png) 控制字符：点一下发送 “p”；
再点一下发送“q”。

 拖动条:

![](media/6d7cc1b6d61a493f95c2e16a5665a0b7.png) 控制字符：拖动拖动条松开时发送“v 100
#”，字符‘v’表示起始字符；数字100表示led2的PWM值；字符‘#’表示终止字符。

 按钮:![](media/be23528229ee588283d4e1d5da695d5e.png) 控制字符：点一下发送 “r”；
再点一下发送“s”。

 拖动条:

![](media/c193ca31a4d923a7ea87683aa0002061.png) 控制字符：拖动拖动条松开时发送“w 153
#”，字符‘w’表示起始字符；数字153表示小风扇的PWM值；字符‘#’表示终止字符。

### 第17课 智能家居完整版课程

1.1 项目介绍：

前面已经安装了智能家居套件的结构部分和学习了各传感器和模块的使用方法，在最后这个综合的实验中，我们来实现智能家居的所有功能。

1.2 实验主要组件：



 ![](media/303e4a39cefdced11c3e567920b9d933.png) ![](media/c93fe0086737d1930fd347d5c4707a0e.jpeg) ![](media/6c14334b97f965614e1d2130b699d649.png) ![](media/a0a4440f98f604fe19573abb5ad735cf.png) ![](media/2dee4678899291cc1a237c49b7552da3.png)

 控制板 * 1 扩展板 * 1 USB线*1 LED模块 6812模块

 ![](media/3e05cae18da9549123032b0bd479d866.png) ![](media/a9a7938da6f59aefa989e7f44a1c5afe.png) ![](media/800d881ecb0dd004ec0d9695d78fec42.png) ![](media/b9a9b948b21541e2423daa90ece6dfe6.png) ![](media/0d22bc84dfb9df305550b3c350b56e03.png)

 无源蜂鸣器模块 Keyes 光敏电阻传感器*1 Keyes130电机模块*1 180度舵机*2 Keyes水滴水蒸气传感器模块*1

 ![](media/8ac56c538ca2e98083ea5eb62153962b.png) ![](media/39c9a78b7fdd871862b85f96f8d1c32b.png) ![](media/7a44ab558734e294abfaa6291cc37df2.png) ![](media/0ca3cb2126968bec4cb55643dc583573.png) ![](media/3878879d9acf81f5df96880df42df587.png)

 Keyes人体红外热释传感器*1 KeyesMQ2传感器*1 KeyesXHT11传感器*1 Keyes LCD1602模块* 1 BT-24蓝牙*1

 ![](media/2c5a756c09457d60dedbe7c9e602d011.png) ![](media/55b45f3b0696580f708ccb41b978e406.png) ![](media/108172d6f4c8219eb6d9455b9a1aacae.png) ![](media/0b475062a35179a5895b47951b109e90.png) 

 Keyes按键*2 充电模块*1 4P 转杜邦线母若干 3P 转杜邦线母若干*1 

1.3接线图：

![](media/66d47d3e40c96648d5f79e492c9c4f3c.png)

 传感器模块名称

传感器模块引脚与传感器扩展板对应的接线

 人体红外传感器模块 G/V/S G/V/2

 无源蜂鸣器模块 G/V/S G/V/3

 按键传感器模块1 G/V/S G/V/4

 黄色LED模块 G/V/S G/V/5

 小风扇模块 GND/VCC/IN+/IN- G/V/6/7

 按键传感器模块2 G/V/S G/V/8

 控制门的舵机1 棕色线/红色线/橙色线 G/V/9

 控制窗的舵机2 棕色线/红色线/橙色线 G/V/10

 MQ-2烟雾传感器模块 GND/VCC/D0/A0 G/V/11/A0

 XHT11模块 G/V/S G/V/12

 GRB灯模块 G/V/S G/V/13

 LCD1602显示屏模块 GND/VCC/SDA/SCL GND/5V/SDA/SCL

 光敏传感器模块 G/V/S G/V/A1

 水蒸气传感器模块 G/V/S G/V/A2

 BT-24蓝牙模块 5V/G/RX/TX VCC/GND/TX/RX

1.4 流程图

![](media/e81eee565abc8df128f26674e71c5e9b.png)

1.5测试代码：

```
/*
 Arduino 智能家居套装
 Project 17
 www.keyes-robot.com
*/
#include <Servo.h>//调用相关库文件
#include <Wire.h>
#include <LiquidCrystal_I2C.h>
#include <Adafruit_NeoPixel.h>
#include <dht11.h> 
#define DHT11_PIN 12 //定义DHT11为数子口12

LiquidCrystal_I2C mylcd(0x27,16,2);
dht11 DHT;
Adafruit_NeoPixel  rgb_display(4);  //定义一个像素的类
volatile int btn1_num;//设置变量btn1_num
volatile int btn2_num;//设置变量btn2_num
volatile int button1;//设置变量button1
volatile int button2;//设置变量button2
String fans_char;    //string类型变量fans_char
volatile int fans_val; //设置变量fans_char
volatile int flag;  //设置变量flag
volatile int flag2; //设置变量flag2
volatile int flag3; //设置变量flag3
volatile int gas; //设置变量gas
volatile int infrar; //设置变量infrar
String led2; //string类型变量led2
volatile int light; //设置变量light
String pass; //string类型变量 pass
String passwd; //string类型变量passwd
String servo1; //string类型变量servo1
volatile int servo1_angle; //设置变量light
String servo2; //string类型变量servo2
volatile int servo2_angle; //设置变量servo2_angle
volatile int soil; //设置变量soil
volatile int val;  //设置变量 val
volatile int value_led2; //设置变量value_led2
volatile int water; //设置变量water

void DHT11()
{
   int chk;
  chk = DHT.read(DHT11_PIN);    // READ DATA
  switch (chk) {
    case DHTLIB_OK:
      break;
    case DHTLIB_ERROR_CHECKSUM: //校检和错误返回
      break;
    case DHTLIB_ERROR_TIMEOUT: //超时错误返回
      break;
    default:
      break;
  }
  // DISPLAT DATA
  mylcd.setCursor (0, 0);
  mylcd.print ("humidity:   %");
  mylcd.setCursor (0, 1);
  mylcd.print ("temperature:  C");
  mylcd.setCursor (10, 0);
  mylcd.print (DHT.humidity);//第一行显示湿度
  mylcd.setCursor (12, 1);
  mylcd.print (DHT.temperature);//第二行显示温度
  Serial.print("humidity:");
  Serial.print(DHT.humidity);
  Serial.print("   temperature:");
  Serial.println(DHT.temperature);
  delay(200);
  }
  
void birthday()//设置生日快乐歌曲
{
  tone(3,294);//数字口3输出294Hz频率声音
  delay(250); //延迟250毫秒
  tone(3,440);
  delay(250);
  tone(3,392);
  delay(250);
  tone(3,532);
  delay(250);
  tone(3,494);
  delay(500);
  tone(3,392);
  delay(250);
  tone(3,440);
  delay(250);
  tone(3,392);
  delay(250);
  tone(3,587);
  delay(250);
  tone(3,532);
  delay(500);
  tone(3,392);
  delay(250);
  tone(3,784);
  delay(250);
  tone(3,659);
  delay(250);
  tone(3,532);
  delay(250);
  tone(3,494);
  delay(250);
  tone(3,440);
  delay(250);
  tone(3,698);
  delay(375);
  tone(3,659);
  delay(250);
  tone(3,532);
  delay(250);
  tone(3,587);
  delay(250);
  tone(3,532);
  delay(500);
}

//定义各个声音频率名称
#define D0 -1
#define D1 262
#define D2 293
#define D3 329
#define D4 349
#define D5 392
#define D6 440
#define D7 494
#define M1 523
#define M2 586
#define M3 658
#define M4 697
#define M5 783
#define M6 879
#define M7 987
#define H1 1045
#define H2 1171
#define H3 1316
#define H4 1393
#define H5 1563
#define H6 1755
#define H7 1971

#define WHOLE 1
#define HALF 0.5
#define QUARTER 0.25
#define EIGHTH 0.25
#define SIXTEENTH 0.625
//设置两个舵机接口 分别是数字口9和数字口10
Servo servo_10;
Servo servo_9;
//设置声音播放频率
int tune[]=
{
  M3,M3,M4,M5,
  M5,M4,M3,M2,
  M1,M1,M2,M3,
  M3,M2,M2,
  M3,M3,M4,M5,
  M5,M4,M3,M2,
  M1,M1,M2,M3,
  M2,M1,M1,
  M2,M2,M3,M1,
  M2,M3,M4,M3,M1,
  M2,M3,M4,M3,M2,
  M1,M2,D5,D0,
  M3,M3,M4,M5,
  M5,M4,M3,M4,M2,
  M1,M1,M2,M3,
  M2,M1,M1
};

//设置音乐节拍
float durt[]=
 {
  1,1,1,1,
  1,1,1,1,
  1,1,1,1,
  1+0.5,0.5,1+1,
  1,1,1,1,
  1,1,1,1,
  1,1,1,1,
  1+0.5,0.5,1+1,
  1,1,1,1,
  1,0.5,0.5,1,1,
  1,0.5,0.5,1,1,
  1,1,1,1,
  1,1,1,1,
  1,1,1,0.5,0.5,
  1,1,1,1,
  1+0.5,0.5,1+1,
 };

 int length;
 int tonepin=3;//设置无源蜂鸣器信号端为数字口3

void Ode_to_Joy()//播放欢乐颂歌曲
{
  for(int x=0;x<length;x++)
  {
    tone(tonepin,tune[x]);
    delay(300*durt[x]);
  }
}
//气体检测
void auto_sensor() {
  gas = analogRead(A0);//模拟口A0的模拟值赋值给gas
  if (gas > 700) {    //如果变量gas大于1000
    flag = 1; //变量flag设为1
    while (flag == 1) { //如果flag为1，循环程序
      Serial.println("danger"); //换行输出"danger"字符
      tone(3,440);
      delay(125);
      delay(100);
      noTone(3);
      delay(100);
      tone(3,440);
      delay(125);
      delay(100);
      noTone(3);
      delay(300);
      gas = analogRead(A0); //模拟口A0的模拟值赋值给gas
      if (gas < 100)         //如果变量gas小于100
      {
        flag = 0; //变量flag设为0
        break;    //退出循环

      }
    }

  } else {
    noTone(3);  //数字口3停止输出音乐

  }
  //功能：天黑人路过灯亮
  light = analogRead(A1); //模拟口A1的模拟值赋值给 light 
  if (light < 300) {      //如果变量light小于300
    infrar = digitalRead(2); //数字口2的数字值赋值给变量infrar
    Serial.println(infrar);  
    if (infrar == 1) {       //如果变量infra为1
      rgb_display.setPixelColor(0, 255, 0, 0); //RGB灯亮红色
      rgb_display.setPixelColor(1, 255, 0, 0); 
      rgb_display.setPixelColor(2, 255, 0, 0); 
      rgb_display.setPixelColor(3, 255, 0, 0); 
      rgb_display.show(); //显示灯珠颜色

    } else {
      rgb_display.setPixelColor(0, 0, 0, 0); //熄灭RGB灯
      rgb_display.setPixelColor(1, 0, 0, 0); 
      rgb_display.setPixelColor(2, 0, 0, 0); 
      rgb_display.setPixelColor(3, 0, 0, 0); 
      rgb_display.show(); 
    }

  }
  
  //功能：检测到下雨关窗
  water = analogRead(A2);//读取水滴传感器检测数值
  if (water > 800) {    //当数据大于800时舵机转动120度关窗
    flag2 = 1;
    while (flag2 == 1) {
      Serial.println("rain");
      servo_10.write(0);
      delay(400);
      water = analogRead(A2); //如果变量water小于30
      if (water < 30) {
        flag2 = 0; //变量flag2设置为0
        break;    //退出循环程序
      }
    }
  } else {
    if (val != 'u' && val != 'o') {
      servo_10.write(120); //数字口10处舵机设置为120度
      delay(10);
    }
  }
  door();//运行子程序
}

//功能函数：输入密码开门
void door() {
  button1 = digitalRead(4);//数字看4的数字值赋值给变量button1
  button2 = digitalRead(8);//数字看8的数字值赋值给变量button2
  if (button1 == 0) {//如果变量button1为0
    delay(10); //延迟10毫秒
    while (button1 == 0) {  //如果变量button1为0，循环程序
      button1 = digitalRead(4); //数字看4的数字值赋值给变量button1
      btn1_num = btn1_num + 1;  //变量btn1_num加1
      delay(100); //延迟100毫秒
    }

  }
  if (btn1_num >= 1 && btn1_num < 5) { //如果变量btn1_num大于等于1并且小于5
    Serial.print(".");
    Serial.print("");
    passwd = String(passwd) + String("."); //设置passwd 字符
    pass = String(pass) + String("*"); //设置pass字符
    mylcd.setCursor(1-1, 2-1); //LCD从第一行第一个字符开始显示pass字符
    mylcd.print(pass);

  }
  //如果变量btn1_num大于等于5
  if (btn1_num >= 5) {
    Serial.print("-");
    passwd = String(passwd) + String("-"); //设置passwd 字符
    pass = String(pass) + String("*"); //设置pass字符
    mylcd.setCursor(1-1, 2-1); //LCD从第一行第一个字符开始显示pass字符
    mylcd.print(pass);

  }
  if (button2 == 0) //如果变量button2为0
  {
    delay(10);
    if (button2 == 0) //如果变量button2为0
    {
      if (passwd == ".--.-.") //如果passwd字符为".--.-."
      {
        mylcd.clear();//LCD清屏
        mylcd.setCursor(1-1, 2-1);//LCD从第二行第一个字符开始显示"open!"字符
        mylcd.print("open!");
        servo_9.write(180);//数字口9处舵机设置为180度
        delay(300);
        delay(5000);
        passwd = "";
        pass = "";
        mylcd.clear();
        mylcd.setCursor(1-1, 1-1);
        mylcd.print("password:");

      } else {
        mylcd.clear();
        mylcd.setCursor(1-1, 1-1);
        mylcd.print("error!");
        passwd = "";
        pass = "";
        delay(2000);
        mylcd.setCursor(1-1, 1-1);
        mylcd.print("again");

      }

    }

  }
  infrar = digitalRead(2); //读取人体红外传感器数据
  //如果变量infrar为0且val字符不是'l' 和 't'字符
  if (infrar == 0 && (val != 'l' && val != 't')) 
  {
    servo_9.write(0);//数字口9处舵机设置为0度
    delay(50);

  }
  if (button2 == 0) //如果变量button2为0
  {
    delay(10);
    while (button2 == 0) {
      button2 = digitalRead(8);//数字口8的数字值赋值给变量button2
      btn2_num = btn2_num + 1;//变量btn2_num加1
      delay(100);
      if (btn2_num >= 15)  //如果变量btn2_num大于等于15
      { 
        tone(3,532);
        delay(125);
        mylcd.clear();
        //LCD从第一行第一个字符开始显示"wait"字符
        mylcd.setCursor(1-1, 1-1);
        mylcd.print("password:");

      } else {
        noTone(3);//数字口3设置停止播放音乐

      }
    }

  }
  btn1_num = 0;//变量 btn1_num设置为0
  btn2_num = 0;//变量 btn2_num设置为0
}
//生日快乐歌曲
void music1() {
  birthday();
}
//欢乐颂歌曲
void music2() {
  Ode_to_Joy();
}
//PWM控制
void pwm_control() {
  switch (val) {
   case 't'://val为字符't'时，循环程序
    servo1 = Serial.readStringUntil('#');
    servo1_angle = String(servo1).toInt();
    servo_9.write(servo1_angle); //数字口9舵机角度设置为servo1_angle
    delay(300);//退出循环
    break;
   case 'u': //val为字符'u'时，循环程序
    servo2 = Serial.readStringUntil('#');
    servo2_angle = String(servo2).toInt();
    servo_10.write(servo2_angle);//数字口10舵机角度设置为servo2_angle
    delay(300);
    break; //退出循环
   case 'v': //val为字符'v'时，循环程序
    led2 = Serial.readStringUntil('#');
    value_led2 = String(led2).toInt();
    analogWrite(5,value_led2); //数字口5的PWM值为value_led2
    break; //退出循环
   case 'w': //val为字符'w'时，循环程序
    fans_char = Serial.readStringUntil('#');
    fans_val = String(fans_char).toInt();
    digitalWrite(7,LOW);
    analogWrite(6,fans_val);//设置数字口6的PWM值为fans_val，数值越大，风扇速度越快
    break;//退出循环
  }
}

void setup(){
  Serial.begin(9600);//设置波特率为9600
  rgb_display.begin();  //启动6812RGB
  rgb_display.setPin(13);  //设置6812管脚接数字口13
  rgb_display.setBrightness(80); //设置亮度为100，范围为0~255
  rgb_display.setPixelColor(0, 0, 0, 0); //熄灭RGB灯
  rgb_display.setPixelColor(1, 0, 0, 0); 
  rgb_display.setPixelColor(2, 0, 0, 0); 
  rgb_display.setPixelColor(3, 0, 0, 0); 
  rgb_display.show(); 
  mylcd.init();
  mylcd.backlight();//初始LCD设置
  servo_9.attach(9);//设置舵机连接在数字口9
  servo_10.attach(10);//设置舵机连接在数字口10
  pinMode(7, OUTPUT);//数字口7设置为输出
  pinMode(6, OUTPUT);//数字看6设置为输出
  servo_9.write(0);//数字口9处舵机设置为0度
  delay(300);
  servo_10.write(120);//数字口10处舵机设置为120度
  delay(300);
  //LCD从第一行第一个位置显示"passcord:"字符
  mylcd.setCursor(0, 0);
  mylcd.print("password:");
  digitalWrite(7,HIGH);//数字口7设置为高电平
  digitalWrite(6,HIGH);//数字口6设置为高电平
  pinMode(4, INPUT);//数字口4设置为输入
  pinMode(8, INPUT);//数字口8设置为输入
  pinMode(2, INPUT);//数字口2设置为输入
  pinMode(3, OUTPUT);//数字口3设置为输出
  pinMode(A0, INPUT);//A0端设置为输入
  pinMode(A1, INPUT);//A1端设置为输入
  pinMode(A2, INPUT);//A2端设置为输入
  val = 0;//变量val设置为0
  button1 = 0;//变量 button1设置为0
  button2 = 0;//变量 button2设置为0
  btn1_num = 0;//变量 btn1_num设置为0
  btn2_num = 0;
  passwd = "";
  pass = "";
  gas = 0;
  flag = 0;
  light = 0;
  infrar = 0;
  water = 0;
  flag2 = 0;
  soil = 0;
  flag3 = 0;
  servo1 = "";
  servo1_angle = 0;
  servo2 = "";
  servo2_angle = 0;
  led2 = "";
  value_led2 = 0;
  fans_char = "";
  fans_val = 0;
  pinMode(5, OUTPUT);
  pinMode(3, OUTPUT);
  length=sizeof(tune)/sizeof(tune[0]);

}

void loop(){
  auto_sensor();
  if (Serial.available() > 0) //串口读取到字符
  {
    val = Serial.read();//val设置为串口读取到的字符
    Serial.println(val);//换行输出val字符
    pwm_control();

  }
  switch (val) {
   case 'a': //如果val为 'a'字符，循环程序
    rgb_display.setPixelColor(0, 0, 0, 255); //RGB灯亮蓝色
    rgb_display.setPixelColor(1, 0, 0, 255);
    rgb_display.setPixelColor(2, 0, 0, 255);
    rgb_display.setPixelColor(3, 0, 0, 255);
    rgb_display.show(); //显示灯珠颜色
    break;
   case 'b':
    rgb_display.setPixelColor(0, 0, 0, 0); //熄灭RGB灯
    rgb_display.setPixelColor(1, 0, 0, 0);
    rgb_display.setPixelColor(2, 0, 0, 0);
    rgb_display.setPixelColor(3, 0, 0, 0);
    rgb_display.show();
    break;
   case 'e':
    music1();//播放生日快乐歌曲
    break;
   case 'f':
    music2();//播放欢乐颂歌曲
    break;//退出循环
   case 'g':
    noTone(3);//数字口3设置停止播放音乐
    break;
   case 'h':
    Serial.println(light);//换行输出变量light数值
    delay(100);
    break;
   case 'i':
    Serial.println(gas);//换行输出变量gas数值
    delay(100);
    break;
   case 'j':
    Serial.println(soil);//换行输出变量soil数值
    delay(100);
    break;
   case 'k':
    Serial.println(water);//换行输出变量water数值
    delay(100);
    break;
   case 'l':
    servo_9.write(100);//数字口9处舵机设置为100度
    delay(500);
    break;
   case 'm':
    servo_9.write(0);//数字口9处舵机设置为0度
    delay(500);
    break;
   case 'n':
    servo_10.write(120);
    delay(500);
    break;
   case 'o':
    servo_10.write(0);
    delay(500);
    break;
   case 'p':
    digitalWrite(5,HIGH);//数字口5设置为高电平,LED亮起
    break;
   case 'q':
    digitalWrite(5,LOW);//数字口5设置为低电平LED熄灭
    break;
   case 'r':
    digitalWrite(7,LOW);//风扇以最快速度逆时针转动
    digitalWrite(6,HIGH);
    break;
   case 's':
    digitalWrite(7,LOW);//小风扇停止转动
    digitalWrite(6,LOW);
    break;
  }
  //如果字符为“C”,LCD屏上显示温湿度
  if (val == 'c'){
    DHT11();
    delay(400);
    mylcd.clear();
    }
   //否则如果字符为“d”,切换密码开门功能模式
   else if (val == 'd'){
    mylcd.setCursor(0, 0);
    mylcd.print("password:");
    door();
    }
  }
```



1.6代码说明:

1.  程序编译前需要先添加库文件![](media/67918c2fa13005fd531490577b9d99a4.png)，否则编译不过；前面没有添加的请参考“**开发环境配置**”资料。

    （2）在上传代码时，不能连接蓝牙模块，需要把蓝牙模块取下，否则整个程序代码上传不成功。

上传测试代码成功后再插上蓝牙模块，配对，连接APP。

（3）APP的下载和使用参考**第16课**

1.7实验结果：

组装好智能家居，上传好上面的实验程序，太阳能电源板的开关拨到ON位置，按下船型开关的1,打开手机APP连接好蓝牙，按下APP的功能按键就可以控制智能家居了，功能如下：

（1）

 按钮:![](media/00166855cc0493ef6340ab202f129959.png)

功能：配对连接BT-24蓝牙模块

 按钮:![](media/ed35b9dcb754d77970e03303a1fa730d.png)

功能：断开蓝牙连接

 按钮:![](media/0bf4845021f35c8b032ad2970d8fbf23.png) 控制字符：点一下发送 “a”；
再点一下发送“b”。 功能：点一下，开启门前的RGB灯；再点一下，关闭门前的RGB灯。

 按钮:![](media/8bbee596be00faa43666dbc89fef52ef.png) 控制字符：点一下发送 “c”；
再点一下发送“d”。 功能：点一下，LCD屏显示温湿度；
再点一下，进入输入密码开锁模式。

 按钮:![](media/2009acb4732995cc83b7fe0ede2a9998.png) 控制字符：按住发送 “e”；
松开发送“g”。 功能：点一下，播放一次生日快乐歌曲。

 按钮:![](media/f0e6081acc58cfd204f416d60656a493.png) 控制字符：按住发送 “f”；
松开发送“g”。 功能：点一下，播放一首欢乐颂音乐

 按钮:![](media/fd82561fc16273f0e366af7df0c06ec4.png) 控制字符：点一下发送 “h”；
再点一下发送“S”。 功能：点一下，开始接收光敏传感器检测到的数据，light处显示检测到的数据；
再点一下，关闭光敏传感器。

 按钮:![](media/df457bfb68d5ee93c82bd0a1b8538440.png) 控制字符：点一下发送 “i”；
再点一下发送“S”。 功能：点一下，开始接收气体传感器检测到的数据，gas处显示检测到的数据；
再点一下，关闭气体传感器。

 按钮:![](media/8220b10511d721d55ce50a8e594cce09.png) 控制字符：点一下发送 “j”；
再点一下发送“S”。 这里没有功能，可自行扩展其他其他传感器

 按钮:![](media/c6892e6f550052216348cafa20dd705d.png) 控制字符：点一下发送 “k”；
再点一下发送“S”。 功能：点一下，开始接收水蒸气传感器检测到的数据，water处显示检测到的数据；
再点一下，关闭水蒸气传感器。

 按钮:![](media/027da5a4bb50c846211290d128a26814.png) 控制字符：点一下发送 “l”；
再点一下发送“m”。 功能：点一下，开启门；
再点一下，关闭门。

 拖动条:

![](media/b2c91a6d1b3d2c7725ab5b45b7d75969.png) 控制字符：拖动拖动条松开时发送“t 50
#”，字符‘t’表示起始字符；数字50表示舵机1的角度；字符‘#’表示终止字符。 功能：拖动条，控制门的转动大小，就是控制舵机1的角度，door处显示拖动条对应的值。

 按钮:![](media/29180fb7638890a0ffb098743ff08384.png) 控制字符：点一下发送 “n”；
再点一下发送“o”。 功能：点一下，开启窗户；
再点一下，关闭窗户。

 拖动条:

![](media/9b9b4b0d56f15dd4f3aac08a57dc1dbd.png) 控制字符：拖动拖动条松开时发送“u 34
#”，字符‘u’表示起始字符；数字34表示舵机2的角度；字符‘#’表示终止字符。 功能：拖动条，控制窗户的转动大小，就是控制舵机2的角度，win处显示拖动条对应的值。

 按钮:![](media/0b9f125d6da42737ff3eae79f5378973.png) 控制字符：点一下发送 “p”；
再点一下发送“q”。 功能：点一下，开启室内LED；
再点一下，关闭室内LED。

 拖动条:

![](media/6d7cc1b6d61a493f95c2e16a5665a0b7.png) 控制字符：拖动拖动条松开时发送“v 100
#”，字符‘v’表示起始字符；数字100表示led2的PWM值；字符‘#’表示终止字符。 功能：拖动条，控制室内LED的亮度，led2处显示拖动条对应的PWM值。

 按钮:![](media/be23528229ee588283d4e1d5da695d5e.png) 控制字符：点一下发送 “r”；
再点一下发送“s”。 功能：点一下，开启小风扇；
再点一下，关闭小风扇。

 拖动条:

![](media/c193ca31a4d923a7ea87683aa0002061.png) 控制字符：拖动拖动条松开时发送“w 153
#”，字符‘w’表示起始字符；数字153表示小风扇的PWM值；字符‘#’表示终止字符。 功能：拖动条，控制小风扇的转速，fans处显示拖动条对应的PWM值。

2.  煤气警报：当MQ2气体传感器检测到煤气泄漏时（数值\>700，这里可以用打火机气体测试）,蜂鸣器发声警报，小于100时停止发声。

3.  下雨关窗：当水滴滴传感器检测数据大于800时，接在引脚10的舵机转动120度关窗，否则转到零度。

4.  天黑开灯：当光敏传感器检测数据小于300并且人体红外传感器检测到有人时，RGB灯亮红色；否则熄灭RGB灯。

5.  输入密码开门：门上有1602LCD显示屏、两个按钮、舵机1，按按钮1输入密码，正确密码是:
    **. - - . - .****(”.”的意思是点击按钮，” -”的意思是长按按钮2S以上)**输入一位显示屏就显示一个“\*”
    号，密码输入完成，按下按钮2，如果密码正确，显示屏显示open，舵机1转到180度，开门，5秒之后，人体红外传感器检测到没人时就会自动关门。如果密码错误，显示屏显示error，两秒后显示again之后可重新输入密码。还可以长按，按钮2，蜂鸣器会响，相当于门铃。
